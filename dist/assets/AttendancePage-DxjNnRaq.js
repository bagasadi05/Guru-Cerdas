import{b as Le,y as Ke,u as Ye,z as Qe,r as d,g as V,n as pe,D as ee,H as Ge,X as Je,j as e,B as S,k as ge,F as We,i as Z,J as Ue,K as Xe,f as me,I as xe,s as N,T as b,x as Ve,N as Ze}from"./index-D1C6o8KR.js";import{B as ea}from"./BottomSheet-B_e8xa_t.js";import{u as aa}from"./useMutation-DEQ-bH50.js";import{E as ta,a as be}from"./jspdf.plugin.autotable-Cos_-fnW.js";var f=(o=>(o.Hadir="Hadir",o.Izin="Izin",o.Sakit="Sakit",o.Alpha="Alpha",o))(f||{});const H=[{value:f.Hadir,label:"Hadir",icon:pe,color:"green"},{value:f.Izin,label:"Izin",icon:ee,color:"yellow"},{value:f.Sakit,label:"Sakit",icon:Ge,color:"blue"},{value:f.Alpha,label:"Alpha",icon:Je,color:"red"}],sa={green:{active:"border-green-500 shadow-lg shadow-green-500/20",hover:"hover:border-green-500/50",icon:"text-green-500"},yellow:{active:"border-yellow-500 shadow-lg shadow-yellow-500/20",hover:"hover:border-yellow-500/50",icon:"text-yellow-500"},blue:{active:"border-blue-500 shadow-lg shadow-blue-500/20",hover:"hover:border-blue-500/50",icon:"text-blue-500"},red:{active:"border-red-500 shadow-lg shadow-red-500/20",hover:"hover:border-red-500/50",icon:"text-red-500"}},ga=()=>{const o=Le(),I=Ke(),{user:u}=Ye(),q=Qe(),B=new Date,_=`${B.getFullYear()}-${String(B.getMonth()+1).padStart(2,"0")}-${String(B.getDate()).padStart(2,"0")}`,[x,fe]=d.useState(""),[c,L]=d.useState(_),[w,K]=d.useState({}),[k,M]=d.useState(new Set),[ye,T]=d.useState(!1),[na,we]=d.useState(!1),[ra,la]=d.useState(""),[ke,Y]=d.useState(!1),[E,je]=d.useState(new Date().toISOString().slice(0,7)),[Q,ae]=d.useState(!1),[ve,te]=d.useState(!1),[A,se]=d.useState(null),[Se,ne]=d.useState(!1),{data:P,isLoading:ia}=V({queryKey:["classes",u==null?void 0:u.id],queryFn:async()=>{const{data:a,error:s}=await N.from("classes").select("*").eq("user_id",u.id);if(s)throw s;return a||[]},enabled:!!u});d.useEffect(()=>{P&&P.length>0&&!x&&fe(P[0].id)},[P,x]);const{data:r,isLoading:Ne}=V({queryKey:["studentsForAttendance",x],queryFn:async()=>{if(!x||!u)return[];const{data:a,error:s}=await N.from("students").select("*").eq("class_id",x).eq("user_id",u.id).order("name",{ascending:!0});if(s)throw s;return a||[]},enabled:!!x&&!!u}),{data:re}=V({queryKey:["attendanceData",x,c],queryFn:async()=>{if(!r||r.length===0)return{};const{data:a,error:s}=await N.from("attendance").select("*").eq("date",c).in("student_id",r.map(n=>n.id));if(s)throw s;return(a||[]).reduce((n,i)=>(n[i.student_id]={id:i.id,status:i.status,note:i.notes||""},n),{})},enabled:!!r&&r.length>0});d.useEffect(()=>{K(re||{})},[re]);const{mutate:Ae,isPending:le}=aa({mutationFn:async a=>{if(q){const{error:s}=await N.from("attendance").upsert(a);if(s)throw s;return{synced:!0}}else return Ze({table:"attendance",operation:"upsert",payload:a}),{synced:!1}},onMutate:async a=>{await I.cancelQueries({queryKey:["attendanceData",x,c]});const s=I.getQueryData(["attendanceData",x,c]);return I.setQueryData(["attendanceData",x,c],(n={})=>{const i={...n};return a.forEach(t=>{t.student_id&&(i[t.student_id]={id:t.id,status:t.status,note:t.notes||""})}),i}),{previousAttendance:s}},onError:(a,s,n)=>{I.setQueryData(["attendanceData",x,c],n==null?void 0:n.previousAttendance),o.error(`Gagal menyimpan absensi: ${a.message}`)},onSuccess:a=>{a.synced?o.success("Absensi berhasil disimpan!"):o.info("Absensi disimpan offline. Akan disinkronkan saat kembali online.")},onSettled:()=>{I.invalidateQueries({queryKey:["attendanceData",x,c]}),I.invalidateQueries({queryKey:["dashboardData"]})}}),De=d.useMemo(()=>{const a=H.reduce((s,n)=>({...s,[n.value]:0}),{});return Object.values(w).forEach(s=>{a[s.status]++}),a},[w]),j=d.useMemo(()=>r?r.filter(a=>!w[a.id]):[],[r,w]);d.useMemo(()=>{if(!r||r.length===0)return 0;const a=r.length-j.length;return Math.round(a/r.length*100)},[r,j]);const Ce=a=>{if(k.size===0)return;const s={...w};k.forEach(n=>{var i;s[n]={...s[n],status:a,note:(a==="Izin"||a==="Sakit")&&((i=s[n])==null?void 0:i.note)||""}}),K(s),M(new Set),o.success(`Status ${k.size} siswa diubah menjadi ${a}`)},Ie=a=>{M(s=>{const n=new Set(s);return n.has(a)?n.delete(a):n.add(a),n})},_e=()=>{k.size===(r==null?void 0:r.length)?M(new Set):r&&M(new Set(r.map(a=>a.id)))},Te=()=>{const a={...w};j.forEach(s=>{a[s.id]={status:f.Hadir,note:""}}),K(a)},$e=()=>{if(!u||!r||j.length>0&&!window.confirm(`Masih ada ${j.length} siswa yang belum diabsen. Apakah Anda ingin menandai mereka semua sebagai "Hadir" dan menyimpan?`))return;const a={...w};j.forEach(n=>{a[n.id]={status:f.Hadir,note:""}});const s=Object.entries(a).map(([n,i])=>({id:i.id||crypto.randomUUID(),student_id:n,date:c,status:i.status,notes:i.note,user_id:u.id}));Ae(s)},ze=async a=>{if(!u)return null;const[s,n]=a.split("-").map(Number),i=`${s}-${String(n).padStart(2,"0")}-01`,t=new Date(s,n,0).toISOString().split("T")[0],[p,v,D]=await Promise.all([N.from("students").select("*").eq("user_id",u.id),N.from("attendance").select("*").eq("user_id",u.id).gte("date",i).lte("date",t),N.from("classes").select("id, name").eq("user_id",u.id)]);if(p.error||v.error||D.error)throw new Error("Gagal mengambil data untuk ekspor.");const $=new Map((D.data||[]).map(C=>[C.id,{name:C.name}]));return{students:(p.data||[]).map(C=>({...C,classes:$.get(C.class_id)||null})),attendance:v.data,classes:D.data}},Oe=async()=>{ae(!0),o.info("Membuat laporan, ini mungkin memakan waktu...");try{const a=await ze(E);if(!a||!a.students||a.students.length===0){o.warning("Tidak ada data untuk bulan yang dipilih.");return}const{students:s,attendance:n,classes:i}=a,t=new ta({orientation:"landscape"}),[p,v]=E.split("-").map(Number),D=new Date(p,v-1).toLocaleString("id-ID",{month:"long"}),$=new Date(p,v,0).getDate(),R=t.internal.pageSize.getHeight(),C=t.internal.pageSize.getWidth(),Me=i.map(m=>({...m,students:s.filter(h=>h.class_id===m.id).sort((h,G)=>h.name.localeCompare(G.name))})).filter(m=>m.students.length>0);let ie=!0;for(const m of Me){ie||t.addPage("landscape"),ie=!1;let h=20;t.setFontSize(18),t.setFont("helvetica","bold"),t.setTextColor("#0284c7"),t.text("Laporan Absensi Bulanan",14,h),t.setFontSize(12),t.setFont("helvetica","normal"),t.setTextColor("#374151"),h+=10,t.text(`Kelas: ${m.name}`,14,h),h+=8,t.text(`Periode: ${D} ${p}`,14,h),h+=15;const G=n.filter(l=>m.students.some(g=>g.id===l.student_id)),z={H:0,S:0,I:0,A:0};G.forEach(l=>{l.status==="Hadir"?z.H++:l.status==="Sakit"?z.S++:l.status==="Izin"?z.I++:l.status==="Alpha"&&z.A++}),t.setFontSize(10);const Ee={H:"#22c55e",S:"#3b82f6",I:"#f59e0b",A:"#ef4444"},Pe={H:"Hadir",S:"Sakit",I:"Izin",A:"Alpha"};let J=14;Object.entries(z).forEach(([l,g])=>{t.setFillColor(Ee[l]),t.roundedRect(J,h-4,18,10,2,2,"F"),t.setTextColor("#1f2937"),t.text(`${Pe[l]}: ${g}`,J+22,h+3),J+=65}),h+=15;const W=[["No","Nama Siswa",...Array.from({length:$},(l,g)=>String(g+1))]],oe=m.students.map((l,g)=>{const y=[String(g+1),l.name];for(let X=1;X<=$;X++){const qe=`${p}-${String(v).padStart(2,"0")}-${String(X).padStart(2,"0")}`,ue=n.find(he=>he.student_id===l.id&&he.date===qe),Be=ue&&{Hadir:"H",Sakit:"S",Izin:"I",Alpha:"A"}[ue.status]||"";y.push(Be)}return y}),O=16,Re=[W[0].slice(0,2+O)],He=oe.map(l=>l.slice(0,2+O)),ce={theme:"grid",headStyles:{fillColor:"#0284c7",textColor:"#ffffff",fontStyle:"bold",halign:"center"},alternateRowStyles:{fillColor:"#f3f4f6"},styles:{fontSize:7,cellPadding:1.5,lineColor:"#d1d5db",lineWidth:.5},columnStyles:{0:{cellWidth:10,halign:"center"},1:{cellWidth:70,fontStyle:"bold"}},didDrawCell:l=>{const g={S:"#3b82f6",I:"#f59e0b",A:"#ef4444"},y=l.cell.text[0];l.column.index>1&&g[y]&&(t.setFillColor(g[y]),t.rect(l.cell.x,l.cell.y,l.cell.width,l.cell.height,"F"),t.setTextColor("#ffffff"),t.text(y,l.cell.x+l.cell.width/2,l.cell.y+l.cell.height/2,{align:"center",baseline:"middle"}))}};if(be(t,{...ce,head:Re,body:He,startY:h}),$>O){const l=[W[0].slice(0,2).concat(W[0].slice(2+O))],g=oe.map(y=>y.slice(0,2).concat(y.slice(2+O)));t.addPage("landscape"),be(t,{...ce,head:l,body:g,startY:20})}let F=t.lastAutoTable.finalY;F+30>R&&(t.addPage("landscape"),F=10),t.setFontSize(9),t.setFont("helvetica","bold"),t.text("Keterangan",14,F+15);let U=14;Object.entries({"H: Hadir":"#16a34a","S: Sakit":"#3b82f6","I: Izin":"#f59e0b","A: Alpha":"#ef4444"}).forEach(([l,g])=>{t.setFillColor(g),t.rect(U,F+20,5,5,"F"),t.setFont("helvetica","normal"),t.setTextColor("#374151"),t.text(l,U+8,F+24),U+=45})}const de=t.internal.getNumberOfPages();for(let m=1;m<=de;m++)t.setPage(m),t.setFontSize(8),t.setTextColor("#6b7280"),t.text(`Laporan dibuat pada ${new Date().toLocaleDateString("id-ID")}`,14,R-10),t.text(`Halaman ${m} dari ${de}`,C-14,R-10,{align:"right"});t.save(`Absensi_${E}.pdf`),o.success("Laporan berhasil diunduh!")}catch(a){o.error(`Gagal membuat laporan: ${a.message}`)}finally{ae(!1)}},Fe=async()=>{if(!r||r.length===0){o.warning("Pilih kelas dengan siswa terlebih dahulu.");return}te(!0),ne(!0),se(null);try{const a=new Date(Date.now()-2592e6).toISOString().split("T")[0],{data:s,error:n}=await N.from("attendance").select("student_id, date, status, students(name)").in("student_id",r.map(D=>D.id)).gte("date",a);if(n)throw n;const i="Anda adalah asisten analisis data untuk guru. Analisis data kehadiran JSON yang diberikan, yang mencakup 30 hari terakhir. Berikan wawasan dalam format JSON yang valid dan sesuai dengan skema. Fokus pada identifikasi siswa dengan kehadiran sempurna, siswa yang sering absen, dan pola absensi yang tidak biasa.",t=`Analisis data kehadiran berikut: ${JSON.stringify(s)}`,p={type:b.OBJECT,properties:{perfect_attendance:{type:b.ARRAY,description:"Nama siswa dengan kehadiran 100% (tidak ada Izin, Sakit, atau Alpha).",items:{type:b.STRING}},frequent_absentees:{type:b.ARRAY,description:"Siswa dengan 3 atau lebih status 'Alpha'.",items:{type:b.OBJECT,properties:{student_name:{type:b.STRING},absent_days:{type:b.NUMBER}}}},pattern_warnings:{type:b.ARRAY,description:"Pola absensi yang tidak biasa atau mengkhawatirkan.",items:{type:b.OBJECT,properties:{pattern_description:{type:b.STRING,description:"cth., 'Tingkat absensi (Alpha) tinggi pada hari Senin.'"},implicated_students:{type:b.ARRAY,description:"Siswa yang terkait dengan pola ini.",items:{type:b.STRING}}}}}}},v=await Ve.models.generateContent({model:"gemini-2.5-flash",contents:t,config:{systemInstruction:i,responseMimeType:"application/json",responseSchema:p}});se(JSON.parse(v.text||"{}"))}catch(a){o.error("Gagal menganalisis data kehadiran."),console.error(a)}finally{ne(!1)}};return e.jsxs("div",{className:"w-full min-h-full p-3 sm:p-4 md:p-6 lg:p-8 flex flex-col",children:[e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-gray-900 dark:text-white",children:"Pendataan Absensi"}),e.jsx("p",{className:"mt-1 text-gray-500 dark:text-gray-400",children:"Kelola kehadiran siswa dengan mudah dan efisien."})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[e.jsxs(S,{onClick:Fe,variant:"outline",disabled:!q,className:"flex-1 md:flex-none justify-center",children:[e.jsx(ge,{className:"w-4 h-4 mr-2 text-purple-500"}),"Analisis AI"]}),e.jsxs(S,{onClick:()=>Y(!0),variant:"outline",className:"flex-1 md:flex-none justify-center",children:[e.jsx(We,{className:"w-4 h-4 mr-2 text-blue-500"}),"Export"]})]})]}),e.jsx("div",{className:"sticky top-0 z-20 bg-white/80 dark:bg-gray-950/80 backdrop-blur-md p-4 border-b border-gray-200 dark:border-gray-800 shadow-sm -mx-4 px-4 sm:mx-0 sm:p-0 sm:static sm:border-none sm:shadow-none mb-6 transition-all",children:e.jsxs("div",{className:"group relative overflow-hidden w-full rounded-2xl bg-gradient-to-br from-white to-blue-50 dark:from-gray-900 dark:to-blue-900/20 border border-blue-100 dark:border-blue-800/50 shadow-sm hover:shadow-md transition-all duration-300 cursor-pointer",onClick:()=>T(!0),children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-blue-500/5 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"}),e.jsxs("div",{className:"relative p-4 sm:p-5 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-400 group-hover:scale-110 transition-transform duration-300",children:e.jsx(Z,{className:"w-6 h-6"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-blue-600 dark:text-blue-400 mb-0.5",children:"Tanggal Absensi"}),e.jsxs("h2",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[new Date(c).toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),c===_&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",children:"Hari Ini"})]})]})]}),e.jsx("div",{className:"w-8 h-8 rounded-full bg-white dark:bg-gray-800 flex items-center justify-center shadow-sm border border-gray-100 dark:border-gray-700 group-hover:bg-blue-50 dark:group-hover:bg-gray-700 transition-colors",children:e.jsx(Ue,{className:"w-5 h-5 text-gray-400 group-hover:text-blue-500"})})]})]})}),r&&r.length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-6",children:H.map(a=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-2xl border border-gray-100 dark:border-gray-700 shadow-sm flex flex-col items-center justify-center relative overflow-hidden group",children:[e.jsx("div",{className:`absolute inset-0 opacity-0 group-hover:opacity-5 transition-opacity bg-${a.color}-500`}),e.jsx(a.icon,{className:`w-6 h-6 mb-2 text-${a.color}-500`}),e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:De[a.value]}),e.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a.label})]},a.value))}),e.jsxs("main",{className:"bg-transparent flex flex-col mb-40",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 px-1",children:[e.jsxs("h3",{className:"font-bold text-lg text-gray-900 dark:text-white flex items-center gap-2",children:["Daftar Siswa",e.jsx("span",{className:"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 text-xs py-0.5 px-2 rounded-full",children:(r==null?void 0:r.length)||0})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[j.length>0&&e.jsxs(S,{onClick:Te,size:"sm",variant:"ghost",className:"text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20",children:["Tandai Sisa Hadir (",j.length,")"]}),e.jsx(S,{size:"sm",variant:"ghost",onClick:_e,className:"text-gray-500",children:k.size===(r==null?void 0:r.length)?"Batal Pilih":"Pilih Semua"})]})]}),e.jsx("div",{className:"space-y-3",children:Ne?e.jsx("div",{className:"p-12 text-center text-gray-500",children:"Memuat daftar siswa..."}):!r||r.length===0?e.jsx("div",{className:"p-12 text-center text-gray-400 bg-white dark:bg-gray-800 rounded-2xl border border-dashed border-gray-300 dark:border-gray-700",children:"Pilih kelas untuk memulai absensi."}):e.jsx(e.Fragment,{children:r.map(a=>{const s=w[a.id],n=k.has(a.id),i=s?H.find(p=>p.value===s.status):null,t=i?sa[i.color]:null;return e.jsx("div",{onClick:()=>Ie(a.id),className:`group relative bg-white dark:bg-gray-800 rounded-2xl p-4 border transition-all duration-200 cursor-pointer hover:shadow-md ${n?"border-blue-500 ring-1 ring-blue-500 shadow-blue-100 dark:shadow-none":"border-gray-100 dark:border-gray-700 hover:border-blue-300 dark:hover:border-blue-700"}`,children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center transition-colors ${n?"bg-blue-500 border-blue-500":"border-gray-300 dark:border-gray-600 group-hover:border-blue-400"}`,children:n&&e.jsx(pe,{className:"w-4 h-4 text-white"})}),e.jsx("img",{src:a.avatar_url,alt:a.name,className:"w-12 h-12 rounded-full object-cover border-2 border-white dark:border-gray-700 shadow-sm bg-gray-100"}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsx("h4",{className:`font-bold text-base truncate ${n?"text-blue-600 dark:text-blue-400":"text-gray-900 dark:text-white"}`,children:a.name}),s!=null&&s.note?e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 italic truncate flex items-center gap-1 mt-0.5",children:[e.jsx(ee,{className:"w-3 h-3"}),' "',s.note,'"']}):e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-0.5",children:"Klik untuk memilih"})]}),i?e.jsxs("div",{className:`px-3 py-1.5 rounded-xl text-xs font-bold flex items-center gap-1.5 border shadow-sm ${t==null?void 0:t.active.replace("shadow-lg","")} bg-white dark:bg-gray-900`,children:[e.jsx(i.icon,{className:`w-4 h-4 ${t==null?void 0:t.icon}`}),e.jsx("span",{className:t==null?void 0:t.icon.replace("text-","text-gray-700 dark:text-"),children:i.label})]}):e.jsx("div",{className:"px-3 py-1.5 rounded-xl text-xs font-medium text-gray-400 bg-gray-50 dark:bg-gray-700/50 border border-gray-100 dark:border-gray-700",children:"Belum diabsen"})]})},a.id)})})})]}),e.jsx("div",{className:"fixed bottom-20 lg:bottom-0 left-0 right-0 z-40 bg-white/95 dark:bg-gray-900/95 backdrop-blur-md border-t border-gray-200 dark:border-gray-800 shadow-[0_-4px_20px_-5px_rgba(0,0,0,0.1)] p-4 transition-transform duration-300",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:k.size>0?e.jsxs("div",{className:"animate-slide-up space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:["Tandai ",e.jsxs("strong",{className:"text-gray-900 dark:text-white",children:[k.size," siswa"]})," sebagai:"]}),e.jsxs(S,{size:"sm",variant:"ghost",onClick:()=>we(!0),className:"text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white",children:[e.jsx(Xe,{className:"w-4 h-4 mr-1"}),"Catatan"]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:H.map(a=>e.jsxs("button",{onClick:()=>Ce(a.value),className:`flex items-center justify-center gap-2 h-12 rounded-xl border font-semibold transition-all active:scale-95 hover:-translate-y-0.5 ${a.value===f.Hadir?"border-green-200 bg-green-50 text-green-700 dark:bg-green-900/20 dark:border-green-800 dark:text-green-400":a.value===f.Sakit?"border-blue-200 bg-blue-50 text-blue-700 dark:bg-blue-900/20 dark:border-blue-800 dark:text-blue-400":a.value===f.Izin?"border-yellow-200 bg-yellow-50 text-yellow-700 dark:bg-yellow-900/20 dark:border-yellow-800 dark:text-yellow-400":"border-red-200 bg-red-50 text-red-700 dark:bg-red-900/20 dark:border-red-800 dark:text-red-400"}`,children:[e.jsx(a.icon,{className:"w-5 h-5"}),e.jsx("span",{children:a.label})]},a.value))})]}):e.jsx(S,{onClick:$e,disabled:le,className:"w-full h-12 text-lg font-bold shadow-lg shadow-indigo-500/20",children:le?"Menyimpan...":q?"Simpan Perubahan Absensi":"Simpan Offline"})})}),e.jsx(me,{title:"Analisis Kehadiran AI",isOpen:ve,onClose:()=>te(!1),icon:e.jsx(ge,{className:"h-5 w-5"}),children:Se?e.jsx("div",{className:"text-center py-8",children:"Menganalisis data..."}):A?e.jsxs("div",{className:"space-y-4 text-sm",children:[A.perfect_attendance.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-green-500",children:"Kehadiran Sempurna"}),e.jsx("p",{children:A.perfect_attendance.join(", ")})]}),A.frequent_absentees.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-yellow-500",children:"Sering Alpha"}),e.jsx("ul",{children:A.frequent_absentees.map(a=>e.jsxs("li",{children:[a.student_name," (",a.absent_days," hari)"]},a.student_name))})]}),A.pattern_warnings.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-red-500",children:"Pola Terdeteksi"}),e.jsx("ul",{children:A.pattern_warnings.map(a=>e.jsxs("li",{children:[a.pattern_description," (Siswa: ",a.implicated_students.join(", "),")"]},a.pattern_description))})]})]}):e.jsx("div",{className:"text-center py-8",children:"Tidak ada hasil."})}),e.jsx(me,{title:"Export Laporan Absensi",isOpen:ke,onClose:()=>Y(!1),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Pilih bulan dan tahun untuk mengekspor laporan absensi ke format PDF."}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"export-month",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Bulan & Tahun"}),e.jsx(xe,{id:"export-month",type:"month",value:E,onChange:a=>je(a.target.value)})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(S,{type:"button",variant:"ghost",onClick:()=>Y(!1),disabled:Q,children:"Batal"}),e.jsx(S,{type:"button",onClick:Oe,disabled:Q,children:Q?"Mengekspor...":"Unduh PDF"})]})]})}),e.jsx(ea,{isOpen:ye,onClose:()=>T(!1),title:"Pilih Tanggal Absensi",children:e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-100 dark:border-blue-800/50 flex items-start gap-3",children:[e.jsx(ee,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:["Anda sedang melihat data absensi untuk tanggal ",e.jsx("span",{className:"font-bold",children:new Date(c).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"})}),"."]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Aksi Cepat"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>{L(_),T(!1)},className:`flex items-center justify-center gap-2 p-3 rounded-xl border transition-all ${c===_?"bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-500/30":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-blue-400 dark:hover:border-blue-500 text-gray-700 dark:text-gray-200"}`,children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Hari Ini"})]}),e.jsxs("button",{onClick:()=>{const a=new Date;a.setDate(a.getDate()-1);const s=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;L(s),T(!1)},className:`flex items-center justify-center gap-2 p-3 rounded-xl border transition-all ${c!==_&&new Date(c).getTime()===new Date(new Date().setDate(new Date().getDate()-1)).getTime()?"bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-500/30":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-blue-400 dark:hover:border-blue-500 text-gray-700 dark:text-gray-200"}`,children:[e.jsx("div",{className:"w-4 h-4 rounded-full border-2 border-current opacity-60"}),e.jsx("span",{className:"font-medium",children:"Kemarin"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"attendance-date",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Pilih Tanggal Manual"}),e.jsxs("div",{className:"relative",children:[e.jsx(xe,{id:"attendance-date",type:"date",value:c,onChange:a=>{L(a.target.value),T(!1)},className:"w-full h-12 pl-10 text-lg"}),e.jsx(Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"})]})]})]})})]})};export{ga as default};

import{x as je,r as N,b as Y,j as e,k as de,B as p,S as U,h as ye,n as F,$ as ie,U as re,C as ze,i as Ve,Z as le,T as z,P as X,a0 as ea,K as Z,Y as V,a1 as Ke,a2 as aa,I as C,a3 as sa,a4 as ta,a5 as na,a6 as ia,w as ra,W as la,y as De,s as f,a7 as da,a as oa,a8 as ca,u as ma,z as ha,g as ga,a9 as ua,aa as xa,e as pa,L as ka,ab as ba,X as ja,f as be}from"./index-D1C6o8KR.js";import{C as M,a as E,b as P,d as _,c as B}from"./Card-DQViJwqL.js";import{S as fe}from"./Select-D9Pc8JrA.js";import{T as ya,a as fa,b as D,c as $}from"./Tabs-46UBlh0T.js";import{o as Na}from"./image-Do6OKbT5.js";import{v as $e}from"./violations.data-D8bejHRP.js";import{F as va}from"./FloatingActionButton-CQmhLiOc.js";import{o as H,s as w,_ as wa,n as Sa,u as J,a as O}from"./schemas-CDlXmjzF.js";import{u as T}from"./useMutation-DEQ-bH50.js";function Re(a,i,d,r){const l=i>=85?"sangat baik":i>=75?"baik":i>=65?"cukup":"perlu peningkatan",o=d>=95?"sangat baik":d>=85?"baik":d>=75?"cukup":"perlu peningkatan";return{summary:{name:a.student.name,age:a.student.age||7,class:a.student.class||"SD",overallAssessment:`${a.student.name} menunjukkan perkembangan yang ${l} dengan rata-rata nilai ${i} dan tingkat kehadiran ${d}%. ${r===0?"Tidak ada catatan pelanggaran yang menunjukkan kedisiplinan yang baik.":"Perlu perhatian pada aspek kedisiplinan."} Terus dukung semangat belajar dan perkembangannya.`},cognitive:{strengths:[`Memiliki nilai rata-rata ${i} yang menunjukkan pemahaman yang ${l}`,i>=75?"Menunjukkan konsistensi dalam mengikuti pembelajaran dengan baik":"Menunjukkan usaha dalam mengikuti pembelajaran","Aktif dalam kegiatan kelas dan partisipasi pembelajaran",a.academicRecords.length>5?"Memiliki catatan penilaian yang lengkap dan konsisten":"Terus mengikuti penilaian dengan baik"].slice(0,4),areasForDevelopment:[i<75?"Perlu peningkatan pemahaman konsep di beberapa mata pelajaran":"Pertahankan dan tingkatkan prestasi akademik","Latihan soal secara rutin untuk memperkuat pemahaman materi",i<70?"Konsultasi dengan guru untuk strategi belajar yang lebih efektif":"Eksplorasi materi tambahan untuk memperdalam pemahaman"].slice(0,3),learningStyle:"Campuran",criticalThinking:i>=75?"Menunjukkan kemampuan berpikir kritis yang baik dengan pemahaman konsep yang solid":"Sedang mengembangkan kemampuan berpikir kritis, perlu latihan lebih banyak",academicComparison:i>=75?"Berada pada atau di atas standar perkembangan anak seusianya":"Sedang berupaya mencapai standar perkembangan sesuai usia"},affective:{positiveCharacters:[`Memiliki kedisiplinan yang ${o} dengan tingkat kehadiran ${d}%`,"Menunjukkan tanggung jawab dalam mengikuti kegiatan sekolah",r===0?"Tidak ada catatan pelanggaran, menunjukkan perilaku yang baik":"Terus berusaha memperbaiki perilaku dan sikap",d>=90?"Sangat konsisten dalam kehadiran menunjukkan komitmen belajar":"Menunjukkan usaha untuk hadir secara teratur"].slice(0,4),socialSkills:"Menunjukkan kemampuan bersosialisasi yang baik dengan teman sebaya dan aktif dalam kegiatan kelompok",characterDevelopmentAreas:[r>0?"Perlu bimbingan lebih dalam memahami dan mematuhi tata tertib sekolah":"Terus kembangkan sikap empati dan kerja sama tim","Latih kemampuan komunikasi dan leadership dalam kegiatan kelompok",d<85?"Tingkatkan kedisiplinan dan konsistensi kehadiran":"Kembangkan inisiatif dan kemandirian dalam belajar"].slice(0,3),emotionalIntelligence:"Mampu mengatur emosi dengan baik sesuai usia dan menunjukkan empati terhadap teman",discipline:d>=95?"Sangat baik":d>=85?"Baik":d>=75?"Cukup":"Perlu peningkatan"},psychomotor:{motorSkills:"Perkembangan motorik sesuai dengan usia dan tahap perkembangan anak",outstandingSkills:["Aktif dalam kegiatan praktik dan pembelajaran hands-on","Menunjukkan koordinasi mata-tangan yang baik","Mampu mengikuti instruksi aktivitas fisik dengan baik"],areasNeedingStimulation:["Tingkatkan aktivitas fisik dan olahraga untuk pengembangan motorik kasar","Latihan keterampilan motorik halus melalui aktivitas seni dan kerajinan"],coordination:"Koordinasi motorik berkembang dengan baik sesuai tahap perkembangan"},recommendations:{homeSupport:["Dampingi anak belajar 30-45 menit setiap hari setelah pulang sekolah dengan suasana yang kondusif","Baca buku cerita atau artikel bersama 15-20 menit sebelum tidur untuk meningkatkan literasi","Diskusikan kegiatan sekolah hari ini dan apresiasi usaha serta pencapaiannya","Buat jadwal belajar yang konsisten dan pastikan waktu istirahat yang cukup"],neededStimulation:{cognitive:["Berikan puzzle, permainan strategi, dan permainan edukatif sesuai usia","Ajak anak berdiskusi tentang hal-hal di sekitar dan dorong rasa ingin tahunya","Latihan soal matematika dan membaca 15-30 menit setiap hari",i<75?"Fokus pada mata pelajaran yang masih perlu peningkatan dengan pendekatan yang menyenangkan":"Berikan tantangan baru untuk meningkatkan kemampuan berpikir kritis"],affective:["Ajarkan anak berbagi dan berempati melalui kegiatan bersama saudara/teman","Libatkan dalam kegiatan sosial keluarga dan komunitas","Berikan tanggung jawab kecil di rumah seperti merapikan mainan atau membantu pekerjaan ringan","Diskusikan nilai-nilai moral melalui cerita dan pengalaman sehari-hari"],psychomotor:["Olahraga atau aktivitas fisik minimal 3-4 kali seminggu (bersepeda, berenang, bermain bola)","Aktivitas seni seperti menggambar, mewarnai, atau membuat kerajinan tangan","Bermain di luar rumah untuk melatih motorik kasar dan eksplorasi lingkungan","Latihan keterampilan sehari-hari seperti mengikat tali sepatu, mengancingkan baju"]},developmentPlan:{threeMonths:[i<75?"Target peningkatan nilai rata-rata menjadi minimal 75":"Target mempertahankan nilai di atas 75 dan meningkatkan 5 poin",d<90?"Konsistensi kehadiran minimal 90%":"Pertahankan kehadiran di atas 90%","Rutinitas belajar teratur 30 menit setiap hari dengan pendampingan","Mengurangi atau menghilangkan pelanggaran kedisiplinan"],sixMonths:["Pencapaian nilai minimal 75 di semua mata pelajaran dengan konsistensi","Kemampuan belajar mandiri meningkat dengan pengawasan minimal","Partisipasi aktif dalam minimal 1 kegiatan ekstrakurikuler","Perkembangan sosial dan karakter yang positif terlihat dari interaksi sehari-hari"]},warningsSigns:["Penurunan motivasi belajar yang drastis atau menunjukkan keengganan pergi sekolah","Perubahan perilaku atau mood yang signifikan dalam waktu singkat","Kesulitan berkonsentrasi dalam waktu lama atau mudah terdistraksi","Keluhan fisik berulang tanpa sebab medis jelas (sakit kepala, sakit perut)","Masalah tidur atau perubahan pola makan yang signifikan","Penurunan nilai akademik yang konsisten dalam beberapa minggu berturut-turut","Konflik berulang dengan teman atau guru di sekolah"]}}}async function Pa(a){var i;try{if(!a||!((i=a.student)!=null&&i.name))throw new Error("Data siswa tidak lengkap");const d=(a.academicRecords||[]).filter(m=>m&&typeof m.score=="number"),r=(a.attendanceRecords||[]).filter(m=>m&&m.status),l=(a.violations||[]).filter(m=>m&&m.description),o=(a.quizPoints||[]).filter(m=>m&&m.activity),h=d.length>0?Math.round(d.reduce((m,c)=>m+c.score,0)/d.length):0,s=d.reduce((m,c)=>{const R=c.subject||"Lainnya";return m[R]||(m[R]=[]),m[R].push(c.score),m},{}),t=Object.entries(s).map(([m,c])=>({subject:m,average:Math.round(c.reduce((R,oe)=>R+oe,0)/c.length)})),u={total:r.length,hadir:r.filter(m=>m.status==="Hadir").length,sakit:r.filter(m=>m.status==="Sakit").length,izin:r.filter(m=>m.status==="Izin").length,alpha:r.filter(m=>m.status==="Alpha").length},j=u.total>0?Math.round(u.hadir/u.total*100):100,k={total:l.length,totalPoints:l.reduce((m,c)=>m+(c.points||0),0),recent:l.slice(-3)};if(!je)return console.warn("AI service not available, using fallback analysis"),Re(a,h,j,k.total);const L="Anda adalah seorang psikolog anak dan ahli perkembangan anak yang berpengalaman. Analisis data perkembangan anak secara holistik berdasarkan domain Kognitif, Afektif, dan Psikomotor. Berikan analisis yang mendalam, empati, dan actionable dalam Bahasa Indonesia yang mudah dipahami.",I=`Analisis perkembangan anak dengan data berikut:

SISWA: ${a.student.name}, Usia: ${a.student.age||7} tahun, Kelas: ${a.student.class||"SD"}

AKADEMIK:
- Jumlah penilaian: ${d.length}
- Rata-rata nilai: ${h}
- Nilai per mapel: ${t.length>0?t.map(m=>`${m.subject} (${m.average})`).join(", "):"Belum ada data"}
- Tertinggi: ${d.length>0?Math.max(...d.map(m=>m.score)):0}
- Terendah: ${d.length>0?Math.min(...d.map(m=>m.score)):0}

KEHADIRAN: ${j}% (${u.hadir}/${u.total} hari)

PERILAKU: ${k.total} pelanggaran (${k.totalPoints} poin)

PARTISIPASI: ${o.length} kegiatan

Berikan analisis dalam format JSON dengan struktur:
{"summary":{"name":"","age":0,"class":"","overallAssessment":""},"cognitive":{"strengths":[],"areasForDevelopment":[],"learningStyle":"","criticalThinking":"","academicComparison":""},"affective":{"positiveCharacters":[],"socialSkills":"","characterDevelopmentAreas":[],"emotionalIntelligence":"","discipline":""},"psychomotor":{"motorSkills":"","outstandingSkills":[],"areasNeedingStimulation":[],"coordination":""},"recommendations":{"homeSupport":[],"neededStimulation":{"cognitive":[],"affective":[],"psychomotor":[]},"developmentPlan":{"threeMonths":[],"sixMonths":[]},"warningsSigns":[]}}`;let g=(await je.models.generateContent({model:"gemini-1.5-flash",contents:I,config:{systemInstruction:L,temperature:.7,maxOutputTokens:8192,responseMimeType:"application/json"}})).text||"{}";g=g.replace(/```json\n?/g,"").replace(/```\n?/g,"").trim();const v=g.match(/\{[\s\S]*\}/);return v&&(g=v[0]),JSON.parse(g)}catch(d){console.error("Error generating child development analysis:",d),console.error("Error details:",d.message);const r=(a.academicRecords||[]).filter(t=>t&&typeof t.score=="number"),l=(a.attendanceRecords||[]).filter(t=>t&&t.status),o=(a.violations||[]).filter(t=>t&&t.description),h=r.length>0?Math.round(r.reduce((t,u)=>t+u.score,0)/r.length):0,s=l.length>0?Math.round(l.filter(t=>t.status==="Hadir").length/l.length*100):100;return Re(a,h,s,o.length)}}const Ca=({studentData:a})=>{const[i,d]=N.useState(null),[r,l]=N.useState(!1),o=Y(),h=async()=>{l(!0);try{const s=await Pa(a);d(s),o.success("Analisis perkembangan anak berhasil dibuat!")}catch(s){o.error("Gagal membuat analisis. Silakan coba lagi."),console.error(s)}finally{l(!1)}};return i?e.jsxs("div",{className:"space-y-6 pb-8",children:[e.jsxs(M,{className:"bg-gradient-to-br from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 border-purple-200 dark:border-purple-800",children:[e.jsx(E,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-purple-500 to-blue-500 rounded-full p-3",children:e.jsx(de,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx(P,{className:"text-2xl",children:"Ringkasan Perkembangan Anak"}),e.jsxs(_,{className:"mt-1",children:[i.summary.name," • ",i.summary.age," Tahun • Kelas ",i.summary.class]})]})]}),e.jsx(p,{onClick:h,disabled:r,variant:"ghost",size:"sm",children:r?e.jsx("div",{className:"w-4 h-4 border-2 border-purple-600 border-t-transparent rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Refresh"]})})]})}),e.jsx(B,{children:e.jsx("p",{className:"text-lg text-gray-700 dark:text-gray-300 leading-relaxed",children:i.summary.overallAssessment})})]}),e.jsxs(M,{children:[e.jsx(E,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-cyan-500 rounded-lg p-2",children:e.jsx(ye,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx(P,{children:"A. Analisis Perkembangan Kognitif (Pengetahuan)"}),e.jsx(_,{children:"Kemampuan akademik dan berpikir"})]})]})}),e.jsxs(B,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-green-700 dark:text-green-400 mb-3 flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5"}),"Kekuatan"]}),e.jsx("ul",{className:"space-y-2",children:i.cognitive.strengths.map((s,t)=>e.jsxs("li",{className:"flex items-start gap-3 text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"text-green-500 mt-1",children:"•"}),e.jsx("span",{children:s})]},t))})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-amber-700 dark:text-amber-400 mb-3 flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5"}),"Area yang Perlu Dikembangkan"]}),e.jsx("ul",{className:"space-y-2",children:i.cognitive.areasForDevelopment.map((s,t)=>e.jsxs("li",{className:"flex items-start gap-3 text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"text-amber-500 mt-1",children:"•"}),e.jsx("span",{children:s})]},t))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("h5",{className:"font-semibold text-blue-900 dark:text-blue-300 mb-2",children:"Gaya Belajar Dominan"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:i.cognitive.learningStyle})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("h5",{className:"font-semibold text-purple-900 dark:text-purple-300 mb-2",children:"Kemampuan Berpikir Kritis"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:i.cognitive.criticalThinking})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("h5",{className:"font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Perbandingan dengan Standar Usia"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:i.cognitive.academicComparison})]})]})]}),e.jsxs(M,{children:[e.jsx(E,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-pink-500 to-rose-500 rounded-lg p-2",children:e.jsx(re,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx(P,{children:"B. Analisis Perkembangan Afektif (Sikap)"}),e.jsx(_,{children:"Karakter, emosi, dan kemampuan sosial"})]})]})}),e.jsxs(B,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-green-700 dark:text-green-400 mb-3 flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5"}),"Karakter Positif yang Menonjol"]}),e.jsx("ul",{className:"space-y-2",children:i.affective.positiveCharacters.map((s,t)=>e.jsxs("li",{className:"flex items-start gap-3 text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"text-green-500 mt-1",children:"✓"}),e.jsx("span",{children:s})]},t))})]}),e.jsxs("div",{className:"bg-pink-50 dark:bg-pink-900/20 rounded-lg p-4",children:[e.jsxs("h5",{className:"font-semibold text-pink-900 dark:text-pink-300 mb-2 flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5"}),"Kemampuan Sosial"]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:i.affective.socialSkills})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("h5",{className:"font-semibold text-purple-900 dark:text-purple-300 mb-2",children:"Kecerdasan Emosional"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:i.affective.emotionalIntelligence})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("h5",{className:"font-semibold text-blue-900 dark:text-blue-300 mb-2",children:"Kedisiplinan"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:i.affective.discipline})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-amber-700 dark:text-amber-400 mb-3 flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5"}),"Area Pengembangan Karakter"]}),e.jsx("ul",{className:"space-y-2",children:i.affective.characterDevelopmentAreas.map((s,t)=>e.jsxs("li",{className:"flex items-start gap-3 text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"text-amber-500 mt-1",children:"→"}),e.jsx("span",{children:s})]},t))})]})]})]}),e.jsxs(M,{children:[e.jsx(E,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-green-500 to-emerald-500 rounded-lg p-2",children:e.jsx(ze,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx(P,{children:"C. Analisis Perkembangan Psikomotor"}),e.jsx(_,{children:"Kemampuan motorik dan keterampilan fisik"})]})]})}),e.jsxs(B,{className:"space-y-6",children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("h5",{className:"font-semibold text-green-900 dark:text-green-300 mb-2",children:"Kemampuan Motorik"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:i.psychomotor.motorSkills})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("h5",{className:"font-semibold text-blue-900 dark:text-blue-300 mb-2",children:"Koordinasi"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:i.psychomotor.coordination})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-green-700 dark:text-green-400 mb-3 flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5"}),"Keterampilan yang Menonjol"]}),e.jsx("ul",{className:"space-y-2",children:i.psychomotor.outstandingSkills.map((s,t)=>e.jsxs("li",{className:"flex items-start gap-3 text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"text-green-500 mt-1",children:"★"}),e.jsx("span",{children:s})]},t))})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-amber-700 dark:text-amber-400 mb-3 flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5"}),"Area yang Perlu Stimulasi"]}),e.jsx("ul",{className:"space-y-2",children:i.psychomotor.areasNeedingStimulation.map((s,t)=>e.jsxs("li",{className:"flex items-start gap-3 text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"text-amber-500 mt-1",children:"►"}),e.jsx("span",{children:s})]},t))})]})]})]}),e.jsxs(M,{className:"bg-gradient-to-br from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 border-amber-200 dark:border-amber-800",children:[e.jsx(E,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-amber-500 to-orange-500 rounded-lg p-2",children:e.jsx(U,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx(P,{children:"D. Rekomendasi untuk Orang Tua"}),e.jsx(_,{children:"Panduan praktis untuk mendukung perkembangan anak"})]})]})}),e.jsxs(B,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-amber-900 dark:text-amber-300 mb-3 flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5"}),"1. Dukungan di Rumah"]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4",children:e.jsx("ul",{className:"space-y-3",children:i.recommendations.homeSupport.map((s,t)=>e.jsxs("li",{className:"flex items-start gap-3 text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"bg-amber-500 text-white rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 text-sm font-semibold mt-0.5",children:t+1}),e.jsx("span",{children:s})]},t))})})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-amber-900 dark:text-amber-300 mb-3 flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5"}),"2. Stimulasi yang Dibutuhkan"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsxs("h5",{className:"font-semibold text-blue-900 dark:text-blue-300 mb-3 flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Kognitif"]}),e.jsx("ul",{className:"space-y-2 text-sm",children:i.recommendations.neededStimulation.cognitive.map((s,t)=>e.jsxs("li",{className:"flex items-start gap-2 text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"text-blue-500",children:"•"}),e.jsx("span",{children:s})]},t))})]}),e.jsxs("div",{className:"bg-pink-50 dark:bg-pink-900/20 rounded-lg p-4",children:[e.jsxs("h5",{className:"font-semibold text-pink-900 dark:text-pink-300 mb-3 flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"Afektif"]}),e.jsx("ul",{className:"space-y-2 text-sm",children:i.recommendations.neededStimulation.affective.map((s,t)=>e.jsxs("li",{className:"flex items-start gap-2 text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"text-pink-500",children:"•"}),e.jsx("span",{children:s})]},t))})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsxs("h5",{className:"font-semibold text-green-900 dark:text-green-300 mb-3 flex items-center gap-2",children:[e.jsx(ze,{className:"w-4 h-4"}),"Psikomotor"]}),e.jsx("ul",{className:"space-y-2 text-sm",children:i.recommendations.neededStimulation.psychomotor.map((s,t)=>e.jsxs("li",{className:"flex items-start gap-2 text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"text-green-500",children:"•"}),e.jsx("span",{children:s})]},t))})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-amber-900 dark:text-amber-300 mb-3 flex items-center gap-2",children:[e.jsx(Ve,{className:"w-5 h-5"}),"3. Rencana Pengembangan"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border-l-4 border-amber-500",children:[e.jsx("h5",{className:"font-semibold text-gray-900 dark:text-gray-100 mb-3",children:"Target 3 Bulan"}),e.jsx("ul",{className:"space-y-2 text-sm",children:i.recommendations.developmentPlan.threeMonths.map((s,t)=>e.jsxs("li",{className:"flex items-start gap-2 text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"text-amber-500",children:"→"}),e.jsx("span",{children:s})]},t))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border-l-4 border-orange-500",children:[e.jsx("h5",{className:"font-semibold text-gray-900 dark:text-gray-100 mb-3",children:"Target 6 Bulan"}),e.jsx("ul",{className:"space-y-2 text-sm",children:i.recommendations.developmentPlan.sixMonths.map((s,t)=>e.jsxs("li",{className:"flex items-start gap-2 text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"text-orange-500",children:"→"}),e.jsx("span",{children:s})]},t))})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-red-700 dark:text-red-400 mb-3 flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5"}),"4. Tanda-tanda yang Perlu Diperhatikan"]}),e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 border border-red-200 dark:border-red-800",children:e.jsx("ul",{className:"space-y-2",children:i.recommendations.warningsSigns.map((s,t)=>e.jsxs("li",{className:"flex items-start gap-3 text-gray-700 dark:text-gray-300",children:[e.jsx(le,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:s})]},t))})})]})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 rounded-lg p-6 border border-purple-200 dark:border-purple-800",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"bg-purple-100 dark:bg-purple-900/30 rounded-full p-2 flex-shrink-0",children:e.jsx(le,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-purple-900 dark:text-purple-300 mb-2",children:"Catatan Penting"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 leading-relaxed",children:"Analisis ini dibuat berdasarkan data akademik dan perilaku yang tersedia. Setiap anak berkembang dengan kecepatan yang berbeda. Jika Anda memiliki kekhawatiran khusus tentang perkembangan anak, konsultasikan dengan guru, psikolog anak, atau ahli perkembangan anak."})]})]})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:[e.jsx("div",{className:"bg-gradient-to-br from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 rounded-full p-6 mb-6",children:e.jsx(de,{className:"w-16 h-16 text-purple-600 dark:text-purple-400"})}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-3",children:"Analisis Perkembangan Anak"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-center max-w-md mb-8",children:"Dapatkan analisis komprehensif tentang perkembangan kognitif, afektif, dan psikomotor anak Anda dengan bantuan AI."}),e.jsx(p,{onClick:h,disabled:r,size:"lg",className:"bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700",children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Menganalisis..."]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-5 h-5 mr-2"}),"Generate Analisis Lengkap"]})})]})},Aa=({studentDetails:a})=>{const[i,d]=N.useState(null),[r,l]=N.useState(!1),o=Y(),h=async()=>{l(!0);try{const{student:s,academicRecords:t,attendanceRecords:u,violations:j}=a,k="Anda adalah seorang konselor akademik AI yang ahli dalam merangkum performa siswa secara holistik. Berikan ringkasan yang seimbang, menyoroti hal positif sambil memberikan saran konstruktif. Gunakan Bahasa Indonesia yang formal namun memotivasi. Format output harus JSON sesuai skema.",L=t.length>0?`Memiliki ${t.length} catatan nilai dengan rata-rata ${Math.round(t.reduce((m,c)=>m+c.score,0)/t.length)}.`:"Belum ada data nilai akademik.",I=`Memiliki ${u.filter(m=>m.status==="Alpha").length} hari alpha, ${u.filter(m=>m.status==="Izin").length} hari izin, dan ${u.filter(m=>m.status==="Sakit").length} hari sakit.`,x=j.length>0?`Terdapat ${j.length} catatan pelanggaran dengan total ${j.reduce((m,c)=>m+c.points,0)} poin.`:"Tidak ada catatan pelanggaran, menunjukkan perilaku yang baik.",g=`
            Analisis data siswa berikut untuk membuat ringkasan performa holistik.
            Nama Siswa: ${s.name}
            Data Akademik: ${L}
            Data Kehadiran: ${I}
            Data Perilaku: ${x}

            Tugas:
            1.  **general_evaluation**: Berikan evaluasi umum 1-2 kalimat.
            2.  **strengths**: Identifikasi 1-2 kekuatan utama siswa (bisa dari akademik, kehadiran, atau perilaku).
            3.  **development_focus**: Identifikasi 1-2 area utama yang memerlukan perhatian atau pengembangan.
            4.  **recommendations**: Berikan 1-2 rekomendasi konkret dan positif untuk siswa atau guru.
            `,v={type:z.OBJECT,properties:{general_evaluation:{type:z.STRING,description:"Evaluasi umum 1-2 kalimat."},strengths:{type:z.ARRAY,items:{type:z.STRING},description:"1-2 kekuatan utama."},development_focus:{type:z.ARRAY,items:{type:z.STRING},description:"1-2 area fokus pengembangan."},recommendations:{type:z.ARRAY,items:{type:z.STRING},description:"1-2 rekomendasi konkret."}},required:["general_evaluation","strengths","development_focus","recommendations"]},A=await je.models.generateContent({model:"gemini-2.5-flash",contents:g,config:{systemInstruction:k,responseMimeType:"application/json",responseSchema:v}});d(JSON.parse(A.text||"{}"))}catch(s){console.error("Failed to generate AI summary:",s),o.error("Gagal membuat ringkasan AI.")}finally{l(!1)}};return e.jsxs(M,{children:[e.jsx(E,{children:e.jsxs(P,{className:"flex items-center gap-3",children:[e.jsx(de,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"}),e.jsx("span",{children:"Ringkasan Performa AI"})]})}),e.jsx(B,{children:r?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-300 dark:bg-gray-700/50 rounded w-full animate-pulse"}),e.jsx("div",{className:"h-4 bg-gray-300 dark:bg-gray-700/50 rounded w-5/6 animate-pulse"}),e.jsx("div",{className:"h-4 bg-gray-300 dark:bg-gray-700/50 rounded w-3/4 animate-pulse"})]}):i?e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300 italic",children:['"',i.general_evaluation,'"']}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 pt-4 border-t border-gray-200 dark:border-white/10",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-bold text-green-600 dark:text-green-400 mb-1",children:"Kekuatan"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-gray-600 dark:text-gray-400",children:i.strengths.map((s,t)=>e.jsx("li",{children:s},t))})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-bold text-yellow-600 dark:text-yellow-400 mb-1",children:"Fokus Pengembangan"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-gray-600 dark:text-gray-400",children:i.development_focus.map((s,t)=>e.jsx("li",{children:s},t))})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-bold text-blue-600 dark:text-blue-400 mb-1",children:"Rekomendasi"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-gray-600 dark:text-gray-400",children:i.recommendations.map((s,t)=>e.jsx("li",{children:s},t))})]})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsxs(p,{onClick:h,disabled:r,children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Buat Ringkasan Performa AI"]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"Dapatkan evaluasi holistik performa siswa."})]})})]})},ne=({icon:a,label:i,value:d,color:r})=>e.jsx(M,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`flex-shrink-0 w-12 h-12 rounded-lg flex items-center justify-center bg-gradient-to-br ${r}`,children:e.jsx(a,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:d}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:i})]})]})}),_a=({records:a,onEdit:i,onDelete:d,isOnline:r})=>{const l=N.useMemo(()=>!a||a.length===0?{}:a.reduce((s,t)=>{const u=t.subject||"Tanpa Mapel";return s[u]||(s[u]=[]),s[u].push(t),s},{}),[a]),o=Object.keys(l).sort();if(o.length===0)return e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center text-gray-400",children:[e.jsx(ea,{className:"w-16 h-16 mb-4 text-gray-600"}),e.jsx("h4",{className:"text-lg font-semibold",children:"Tidak Ada Data Nilai Mata Pelajaran"}),e.jsx("p",{className:"text-sm",children:"Nilai yang Anda tambahkan akan muncul di sini."})]});const h=s=>s>=85?{border:"border-green-600/50",text:"text-green-400"}:s>=70?{border:"border-yellow-600/50",text:"text-yellow-400"}:{border:"border-red-600/50",text:"text-red-400"};return e.jsx("div",{className:"space-y-6",children:o.map(s=>{const t=[...l[s]].sort((j,k)=>new Date(k.created_at).getTime()-new Date(j.created_at).getTime()),u=t.length>0?Math.round(t.reduce((j,k)=>j+k.score,0)/t.length):0;return e.jsxs(M,{className:"bg-gray-50 dark:bg-black/20",children:[e.jsx(E,{className:"border-b border-gray-200 dark:border-white/10",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(P,{children:s}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:u}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Rata-rata"})]})]})}),e.jsx(B,{className:"divide-y divide-gray-200 dark:divide-white/10 p-0",children:t.map(j=>{const k=h(j.score);return e.jsxs("div",{className:"group relative p-4 hover:bg-gray-100 dark:hover:bg-white/5",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`flex-shrink-0 w-14 h-14 rounded-full flex items-center justify-center font-black text-2xl border-2 ${k.border} ${k.text} shadow-inner`,children:j.score}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("h4",{className:"font-bold text-base text-gray-900 dark:text-white",children:j.assessment_name||"Penilaian"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 font-medium",children:new Date(j.created_at).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"})}),j.notes&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1 italic",children:['"',j.notes,'"']})]})]}),e.jsxs("div",{className:"absolute top-3 right-3 flex items-center space-x-1 opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"h-8 w-8 bg-gray-200 dark:bg-black/30 backdrop-blur-sm",onClick:()=>i(j),"aria-label":"Edit Catatan Akademik",disabled:!r,children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-500 dark:text-red-400 hover:text-red-600 dark:hover:text-red-300 bg-gray-200 dark:bg-black/30 backdrop-blur-sm",onClick:()=>d(j.id),"aria-label":"Hapus Catatan Akademik",disabled:!r,children:e.jsx(V,{className:"h-4 w-4"})})]})]},j.id)})})]},s)})})},Ta=({records:a,onAdd:i,onEdit:d,onDelete:r,isOnline:l})=>e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Nilai Akademik"}),e.jsx(_,{children:"Daftar nilai sumatif atau formatif yang telah diinput."})]}),e.jsxs(p,{onClick:i,disabled:!l,children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Tambah Nilai"]})]}),e.jsx(_a,{records:a,onEdit:d,onDelete:r,isOnline:l})]}),Ma=({records:a,onEdit:i,onDelete:d,isOnline:r})=>{if(!a||a.length===0)return e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center text-gray-400",children:[e.jsx(F,{className:"w-16 h-16 mb-4 text-gray-600"}),e.jsx("h4",{className:"text-lg font-semibold",children:"Tidak Ada Poin Keaktifan"}),e.jsx("p",{className:"text-sm",children:"Poin yang Anda tambahkan akan muncul di sini."})]});const l=[...a].sort((o,h)=>new Date(h.quiz_date).getTime()-new Date(o.quiz_date).getTime());return e.jsx("div",{className:"space-y-3",children:l.map(o=>e.jsxs("div",{className:"group flex items-center gap-4 p-3 rounded-lg bg-gray-50 dark:bg-black/20 hover:bg-gray-100 dark:hover:bg-black/30 transition-all",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center font-bold text-2xl bg-green-100 dark:bg-green-900/40 text-green-700 dark:text-green-200",children:"+1"}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:o.quiz_name}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[o.subject," · ",new Date(o.quiz_date).toLocaleDateString("id-ID")]})]}),e.jsxs("div",{className:"flex items-center space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>i(o),"aria-label":"Edit Poin",disabled:!r,children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-500 dark:text-red-400",onClick:()=>d(o.id),"aria-label":"Hapus Poin",disabled:!r,children:e.jsx(V,{className:"h-4 w-4"})})]})]},o.id))})},Ia=({quizPoints:a,onAdd:i,onEdit:d,onDelete:r,onApplyPoints:l,isOnline:o})=>e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Poin Keaktifan Kelas"}),e.jsx(_,{children:"Catatan poin untuk keaktifan siswa saat pelajaran."})]}),e.jsxs(p,{onClick:i,disabled:!o,children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Tambah Poin"]})]}),a.length>0&&e.jsxs("div",{className:"mb-4 p-4 bg-purple-50 dark:bg-purple-900/20 rounded-xl flex items-center justify-between animate-fade-in",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-gray-900 dark:text-white",children:["Total ",a.length," Poin Tersedia"]}),e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-300",children:"Gunakan poin ini untuk menambah nilai akhir mata pelajaran."})]}),e.jsxs(p,{onClick:l,variant:"outline",className:"bg-white/50 dark:bg-white/10 border-purple-200 dark:border-purple-400/50 hover:bg-purple-100 dark:hover:bg-purple-500/20 text-purple-700 dark:text-purple-300 hover:text-purple-900 dark:hover:text-white",children:[e.jsx(ie,{className:"w-4 h-4 mr-2"})," Gunakan Poin"]})]}),e.jsx(Ma,{records:a,onEdit:d,onDelete:r,isOnline:o})]}),qa=({violations:a,onAdd:i,onEdit:d,onDelete:r,isOnline:l})=>e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Riwayat Pelanggaran"}),e.jsx(_,{children:"Semua catatan pelanggaran tata tertib sekolah."})]}),e.jsxs(p,{onClick:i,disabled:!l,children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Tambah Pelanggaran"]})]}),a.length>0?e.jsx("div",{className:"space-y-3",children:[...a].sort((o,h)=>new Date(h.date).getTime()-new Date(o.date).getTime()).map(o=>e.jsxs("div",{className:"group flex items-center gap-4 p-3 rounded-lg bg-red-50 dark:bg-red-900/20",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:o.description}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[new Date(o.date).toLocaleDateString("id-ID")," - ",e.jsxs("span",{className:"font-bold text-red-600 dark:text-red-400",children:[o.points," poin"]})]})]}),e.jsxs("div",{className:"ml-auto flex opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>d(o),disabled:!l,children:e.jsx(Z,{className:"h-4 h-4"})}),e.jsx(p,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-600 dark:text-red-400",onClick:()=>r(o.id),disabled:!l,children:e.jsx(V,{className:"h-4 h-4"})})]})]},o.id))}):e.jsxs("div",{className:"text-center py-16 text-gray-400",children:[e.jsx(Ke,{className:"w-16 h-16 mx-auto mb-4 text-gray-600"}),e.jsx("h4",{className:"font-semibold",children:"Tidak Ada Pelanggaran"}),e.jsx("p",{children:"Siswa ini memiliki catatan perilaku yang bersih."})]})]}),za=({reports:a,onAdd:i,onEdit:d,onDelete:r,isOnline:l})=>e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Catatan Guru"}),e.jsx(_,{children:"Catatan perkembangan, laporan, atau insiden khusus."})]}),e.jsxs(p,{onClick:i,disabled:!l,children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Tambah Catatan"]})]}),a.length>0?e.jsx("div",{className:"space-y-3",children:[...a].sort((o,h)=>new Date(h.date).getTime()-new Date(o.date).getTime()).map(o=>e.jsxs("div",{className:"group relative p-4 rounded-lg bg-gray-50 dark:bg-black/20",children:[e.jsxs("div",{className:"absolute top-3 right-3 opacity-100 lg:opacity-0 lg:group-hover:opacity-100 transition-opacity",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>d(o),disabled:!l,children:e.jsx(Z,{className:"h-4 h-4"})}),e.jsx(p,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-600 dark:text-red-400",onClick:()=>r(o.id),disabled:!l,children:e.jsx(V,{className:"h-4 h-4"})})]}),e.jsx("h4",{className:"font-bold text-gray-900 dark:text-white",children:o.title}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:new Date(o.date).toLocaleDateString("id-ID")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:o.notes})]},o.id))}):e.jsxs("div",{className:"text-center py-16 text-gray-400",children:[e.jsx(ye,{className:"w-16 h-16 mx-auto mb-4 text-gray-600"}),e.jsx("h4",{className:"font-semibold",children:"Tidak Ada Catatan"}),e.jsx("p",{children:"Belum ada catatan guru untuk siswa ini."})]})]}),Ra=({communications:a,userAvatarUrl:i,onSendMessage:d,onEditMessage:r,onDeleteMessage:l,isOnline:o,isSending:h})=>{const[s,t]=N.useState(""),u=N.useRef(null);N.useEffect(()=>{var k;(k=u.current)==null||k.scrollIntoView({behavior:"smooth"})},[a]);const j=k=>{k.preventDefault(),s.trim()&&(d(s),t(""))};return e.jsxs("div",{className:"flex flex-col h-[60vh]",children:[e.jsx("div",{className:"p-6",children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(aa,{className:"w-5 h-5 text-blue-500 dark:text-blue-400"}),"Komunikasi dengan Orang Tua"]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 p-4 bg-gray-50 dark:bg-black/20",children:[a.map(k=>e.jsxs("div",{className:`group flex items-start gap-3 ${k.sender==="teacher"?"justify-end":"justify-start"}`,children:[k.sender==="parent"&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center flex-shrink-0",children:e.jsx(re,{className:"w-5 h-5 text-gray-600 dark:text-gray-300"})}),e.jsxs("div",{className:`relative max-w-md p-3 rounded-2xl text-sm ${k.sender==="teacher"?"bg-blue-600 dark:bg-blue-500 text-white rounded-br-none":"bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-bl-none shadow-sm"}`,children:[e.jsx("p",{className:"whitespace-pre-wrap",children:k.message}),e.jsxs("div",{className:`flex items-center gap-1 text-xs mt-1 ${k.sender==="teacher"?"text-blue-100 dark:text-blue-200 justify-end":"text-gray-500 dark:text-gray-400 justify-end"}`,children:[e.jsx("span",{children:new Date(k.created_at).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})}),k.sender==="teacher"&&k.is_read&&e.jsx(F,{className:"w-3.5 h-3.5"})]}),k.sender==="teacher"&&o&&e.jsxs("div",{className:"absolute top-0 -left-20 flex items-center space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"h-7 w-7 bg-gray-200 dark:bg-black/30",onClick:()=>r(k),children:e.jsx(Z,{className:"w-3.5 h-3.5"})}),e.jsx(p,{variant:"ghost",size:"icon",className:"h-7 w-7 bg-gray-200 dark:bg-black/30 text-red-600 dark:text-red-400",onClick:()=>l(k.id),children:e.jsx(V,{className:"w-3.5 h-3.5"})})]})]}),k.sender==="teacher"&&e.jsx("img",{src:i,className:"w-8 h-8 rounded-full object-cover flex-shrink-0",alt:"Guru"})]},k.id)),e.jsx("div",{ref:u})]}),e.jsxs("form",{onSubmit:j,className:"p-4 border-t border-gray-200 dark:border-white/10 flex items-center gap-2",children:[e.jsx(C,{value:s,onChange:k=>t(k.target.value),placeholder:"Ketik pesan...",className:"flex-1",disabled:!o||h}),e.jsx(p,{type:"submit",size:"icon",disabled:!o||!s.trim()||h,children:e.jsx(sa,{className:"w-5 h-5"})})]})]})},Ka=({student:a,onGenerateCode:i,isOnline:d,isGenerating:r})=>{const[l,o]=N.useState(!1),h=Y(),s=()=>{a.access_code&&(navigator.clipboard.writeText(a.access_code),o(!0),setTimeout(()=>o(!1),2e3))},t=()=>{navigator.share&&a.access_code?navigator.share({title:`Akses Portal Siswa - ${a.name}`,text:`Gunakan kode akses ${a.access_code} untuk melihat perkembangan ${a.name} di portal siswa.`,url:window.location.origin}).then(()=>console.log("Successful share")).catch(j=>console.log("Error sharing",j)):h.info("Fitur berbagi tidak didukung di browser ini. Silakan salin kodenya secara manual.")},u=()=>{window.print()};return e.jsxs("div",{className:"p-6",children:[e.jsx(P,{children:"Akses Portal Orang Tua"}),e.jsx(_,{children:"Bagikan kode akses ini kepada orang tua atau wali siswa."}),e.jsx("div",{className:"flex justify-center mt-6",children:a.access_code?e.jsxs("div",{className:"w-full max-w-md p-6 rounded-2xl bg-gradient-to-br from-indigo-100 to-purple-100 dark:from-indigo-600 dark:to-purple-700 shadow-xl text-indigo-900 dark:text-white text-center",children:[e.jsxs("p",{className:"font-semibold",children:["Kode Akses untuk ",a.name]}),e.jsx("div",{className:"my-4 p-4 bg-white/50 dark:bg-black/20 rounded-lg border border-indigo-200 dark:border-white/20",children:e.jsx("p",{className:"text-4xl font-mono font-bold tracking-[0.3em]",children:a.access_code})}),e.jsx("p",{className:"text-xs text-indigo-700 dark:text-indigo-200 mb-6",children:"Kode ini unik dan bersifat rahasia. Gunakan untuk masuk ke portal siswa."}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:[e.jsxs(p,{onClick:s,variant:"outline",className:"bg-white/50 dark:bg-white/10 border-indigo-200 dark:border-white/20 hover:bg-white/80 dark:hover:bg-white/20 backdrop-blur-sm col-span-2 sm:col-span-1 text-indigo-900 dark:text-white",children:[l?e.jsx(ta,{className:"w-4 h-4 mr-2 text-green-500 dark:text-green-400"}):e.jsx(na,{className:"w-4 h-4 mr-2"}),l?"Disalin!":"Salin"]}),e.jsxs(p,{onClick:t,variant:"outline",className:"bg-white/50 dark:bg-white/10 border-indigo-200 dark:border-white/20 hover:bg-white/80 dark:hover:bg-white/20 backdrop-blur-sm text-indigo-900 dark:text-white",children:[e.jsx(ia,{className:"w-4 h-4 mr-2"}),"Bagikan"]}),e.jsxs(p,{onClick:u,variant:"outline",className:"bg-white/50 dark:bg-white/10 border-indigo-200 dark:border-white/20 hover:bg-white/80 dark:hover:bg-white/20 backdrop-blur-sm text-indigo-900 dark:text-white",children:[e.jsx(ra,{className:"w-4 h-4 mr-2"}),"Cetak Slip"]}),e.jsx(p,{onClick:i,variant:"outline",className:"bg-white/50 dark:bg-white/10 border-indigo-200 dark:border-white/20 hover:bg-white/80 dark:hover:bg-white/20 backdrop-blur-sm text-indigo-900 dark:text-white",disabled:!d||r,children:"Buat Baru"})]})]}):e.jsxs("div",{className:"text-center space-y-4 py-8",children:[e.jsx(la,{className:"w-16 h-16 mx-auto text-gray-400 dark:text-gray-600"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:"Siswa ini belum memiliki kode akses portal."}),e.jsxs(p,{onClick:i,disabled:!d||r,children:[e.jsx(U,{className:"w-4 h-4 mr-2"})," Buat Kode Akses"]})]})})]})},Da=H({name:w().min(1,"Nama lengkap harus diisi"),gender:wa(["Laki-laki","Perempuan"]),class_id:w().min(1,"Kelas harus dipilih")}),$a=H({date:w().min(1,"Tanggal harus diisi"),title:w().min(1,"Judul harus diisi"),notes:w().min(1,"Catatan harus diisi")}),Ea=H({subject:w().min(1,"Mata pelajaran harus diisi"),assessment_name:w().min(1,"Nama penilaian harus diisi"),score:Sa().min(0,"Nilai minimal 0").max(100,"Nilai maksimal 100"),notes:w().optional()}),Ba=H({quiz_date:w().min(1,"Tanggal harus diisi"),subject:w().min(1,"Mata pelajaran harus diisi"),quiz_name:w().min(1,"Aktivitas harus diisi")}),Fa=H({date:w().min(1,"Tanggal harus diisi"),description:w().min(1,"Jenis pelanggaran harus dipilih")}),La=H({message:w().min(1,"Pesan tidak boleh kosong")}),Ga=({defaultValues:a,classes:i,onSubmit:d,onClose:r,isPending:l})=>{var t,u;const{register:o,handleSubmit:h,formState:{errors:s}}=J({resolver:O(Da),defaultValues:{name:a.name,gender:a.gender,class_id:a.class_id||""}});return e.jsxs("form",{onSubmit:h(d),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Nama Lengkap"}),e.jsx(C,{...o("name"),error:(t=s.name)==null?void 0:t.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Jenis Kelamin"}),e.jsxs("div",{className:"flex gap-4 mt-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",value:"Laki-laki",...o("gender"),className:"form-radio"}),e.jsx("span",{className:"ml-2",children:"Laki-laki"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",value:"Perempuan",...o("gender"),className:"form-radio"}),e.jsx("span",{className:"ml-2",children:"Perempuan"})]})]}),s.gender&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.gender.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Kelas"}),e.jsxs(fe,{...o("class_id"),error:(u=s.class_id)==null?void 0:u.message,children:[e.jsx("option",{value:"",children:"-- Pilih Kelas --"}),i.map(j=>e.jsx("option",{value:j.id,children:j.name},j.id))]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(p,{type:"button",variant:"ghost",onClick:r,children:"Batal"}),e.jsx(p,{type:"submit",disabled:l,children:l?"Menyimpan...":"Simpan"})]})]})},Ua=({defaultValues:a,onSubmit:i,onClose:d,isPending:r})=>{var s,t;const{register:l,handleSubmit:o,formState:{errors:h}}=J({resolver:O($a),defaultValues:{date:(a==null?void 0:a.date)||new Date().toISOString().slice(0,10),title:(a==null?void 0:a.title)||"",notes:(a==null?void 0:a.notes)||""}});return e.jsxs("form",{onSubmit:o(i),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tanggal"}),e.jsx(C,{type:"date",...l("date"),error:(s=h.date)==null?void 0:s.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Judul"}),e.jsx(C,{...l("title"),placeholder:"cth. Insiden di kelas",error:(t=h.title)==null?void 0:t.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Catatan"}),e.jsx("textarea",{...l("notes"),rows:4,className:`w-full mt-1 block rounded-md shadow-sm sm:text-sm dark:bg-gray-800 dark:border-gray-600 ${h.notes?"border-red-500 focus:border-red-500 focus:ring-red-500":"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500"}`}),h.notes&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:h.notes.message})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(p,{type:"button",variant:"ghost",onClick:d,children:"Batal"}),e.jsx(p,{type:"submit",disabled:r,children:r?"Menyimpan...":"Simpan"})]})]})},Ha=({defaultValues:a,onSubmit:i,onClose:d,isPending:r})=>{var s,t,u;const{register:l,handleSubmit:o,formState:{errors:h}}=J({resolver:O(Ea),defaultValues:{subject:(a==null?void 0:a.subject)||"",assessment_name:(a==null?void 0:a.assessment_name)||"",score:(a==null?void 0:a.score)||0,notes:(a==null?void 0:a.notes)||""}});return e.jsxs("form",{onSubmit:o(i),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Mata Pelajaran"}),e.jsx(C,{...l("subject"),placeholder:"cth. Matematika",error:(s=h.subject)==null?void 0:s.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Nama Penilaian"}),e.jsx(C,{...l("assessment_name"),placeholder:"cth. PH 1, UTS",error:(t=h.assessment_name)==null?void 0:t.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Nilai (0-100)"}),e.jsx(C,{type:"number",...l("score",{valueAsNumber:!0}),min:"0",max:"100",error:(u=h.score)==null?void 0:u.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Catatan (Opsional)"}),e.jsx("textarea",{...l("notes"),rows:3,placeholder:"cth. Sangat baik dalam materi aljabar.",className:"w-full mt-1 block rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm dark:bg-gray-800 dark:border-gray-600"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(p,{type:"button",variant:"ghost",onClick:d,children:"Batal"}),e.jsx(p,{type:"submit",disabled:r,children:r?"Menyimpan...":"Simpan"})]})]})},Ja=({defaultValues:a,onSubmit:i,onClose:d,isPending:r})=>{var s,t,u;const{register:l,handleSubmit:o,formState:{errors:h}}=J({resolver:O(Ba),defaultValues:{quiz_date:(a==null?void 0:a.quiz_date)||new Date().toISOString().slice(0,10),subject:(a==null?void 0:a.subject)||"",quiz_name:(a==null?void 0:a.quiz_name)||""}});return e.jsxs("form",{onSubmit:o(i),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tanggal"}),e.jsx(C,{type:"date",...l("quiz_date"),error:(s=h.quiz_date)==null?void 0:s.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Mata Pelajaran"}),e.jsx(C,{...l("subject"),placeholder:"cth. IPA",error:(t=h.subject)==null?void 0:t.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Aktivitas"}),e.jsx(C,{...l("quiz_name"),placeholder:"cth. Aktif bertanya di kelas",error:(u=h.quiz_name)==null?void 0:u.message})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(p,{type:"button",variant:"ghost",onClick:d,children:"Batal"}),e.jsx(p,{type:"submit",disabled:r,children:r?"Menyimpan...":"Simpan"})]})]})},Oa=({defaultValues:a,onSubmit:i,onClose:d,isPending:r})=>{var s,t;const{register:l,handleSubmit:o,formState:{errors:h}}=J({resolver:O(Fa),defaultValues:{date:(a==null?void 0:a.date)||new Date().toISOString().slice(0,10),description:(a==null?void 0:a.description)||""}});return e.jsxs("form",{onSubmit:o(i),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tanggal"}),e.jsx(C,{type:"date",...l("date"),error:(s=h.date)==null?void 0:s.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Jenis Pelanggaran"}),e.jsxs(fe,{...l("description"),error:(t=h.description)==null?void 0:t.message,children:[e.jsx("option",{value:"",children:"-- Pilih Pelanggaran --"}),$e.map(u=>e.jsxs("option",{value:u.description,children:[u.description," (",u.points," poin)"]},u.code))]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(p,{type:"button",variant:"ghost",onClick:d,children:"Batal"}),e.jsx(p,{type:"submit",disabled:r,children:r?"Menyimpan...":"Simpan"})]})]})},Qa=({defaultValues:a,onSubmit:i,onClose:d,isPending:r})=>{const{register:l,handleSubmit:o,formState:{errors:h}}=J({resolver:O(La),defaultValues:{message:a.message}});return e.jsxs("form",{onSubmit:o(i),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Pesan"}),e.jsx("textarea",{...l("message"),rows:5,className:`w-full mt-1 block rounded-md shadow-sm sm:text-sm dark:bg-gray-800 dark:border-gray-600 ${h.message?"border-red-500 focus:border-red-500 focus:ring-red-500":"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500"}`}),h.message&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:h.message.message})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(p,{type:"button",variant:"ghost",onClick:d,children:"Batal"}),e.jsx(p,{type:"submit",disabled:r,children:r?"Menyimpan...":"Simpan"})]})]})},Wa=(a,i)=>{const d=Y(),r=De(),l={onSuccess:()=>{r.invalidateQueries({queryKey:["studentDetails",a]}),r.invalidateQueries({queryKey:["dashboardData"]}),i(),d.success("Data berhasil disimpan!")},onError:x=>{d.error(x.message)}},o=T({mutationFn:async x=>{if(!a)throw new Error("Student ID is missing");const{error:g}=await f.from("students").update(x).eq("id",a);if(g)throw g},...l}),h=T({mutationFn:async x=>{if(x.operation==="add"){const{error:g}=await f.from("reports").insert(x.data);if(g)throw g}else{const{error:g}=await f.from("reports").update(x.data).eq("id",x.id);if(g)throw g}},...l}),s=T({mutationFn:async x=>{if(x.operation==="add"){const{error:g}=await f.from("academic_records").insert(x.data);if(g)throw g}else{const{error:g}=await f.from("academic_records").update(x.data).eq("id",x.id);if(g)throw g}},...l}),t=T({mutationFn:async x=>{if(x.operation==="add"){const{error:g}=await f.from("quiz_points").insert(x.data);if(g)throw g}else{const{error:g}=await f.from("quiz_points").update(x.data).eq("id",x.id);if(g)throw g}},...l}),u=T({mutationFn:async x=>{if(x.operation==="add"){const{error:g}=await f.from("violations").insert(x.data);if(g)throw g}else{const{error:g}=await f.from("violations").update(x.data).eq("id",x.id);if(g)throw g}},...l}),j=T({mutationFn:async x=>{const{error:g}=await f.from("communications").update(x.data).eq("id",x.id);if(g)throw g},...l}),k=T({mutationFn:async({table:x,id:g})=>{const{error:v}=await f.from(x).delete().eq("id",g);if(v)throw v},onSuccess:(x,g)=>{r.invalidateQueries({queryKey:["studentDetails",a]}),i(),d.success(`Data dari tabel ${g.table} berhasil dihapus.`)},onError:x=>{d.error(x.message)}}),L=T({mutationFn:async x=>{if(!a)throw new Error("Data tidak lengkap");const{data:{user:g}}=await f.auth.getUser();if(!g)throw new Error("User not authenticated");const{error:v}=await f.from("communications").insert({student_id:a,user_id:g.id,message:x,sender:"teacher",is_read:!1});if(v)throw v},onSuccess:()=>{r.invalidateQueries({queryKey:["studentDetails",a]})},onError:x=>d.error(x.message)}),I=T({mutationFn:async x=>{if(!a)throw new Error("Data tidak lengkap");const{data:{user:g}}=await f.auth.getUser();if(!g)throw new Error("User not authenticated");const{error:v}=await f.rpc("apply_quiz_points_to_grade",{student_id_param:a,subject_param:x,user_id_param:g.id});if(v)throw v},onSuccess:()=>{r.invalidateQueries({queryKey:["studentDetails",a]}),i(),d.success("Poin berhasil diterapkan dan nilai diperbarui!")},onError:x=>d.error(`Gagal menerapkan poin: ${x.message}`)});return{studentMutation:o,reportMutation:h,academicMutation:s,quizMutation:t,violationMutation:u,communicationMutation:j,deleteMutation:k,sendMessageMutation:L,applyPointsMutation:I}},Ya=()=>{const a="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";let i="";for(let d=0;d<6;d++)i+=a.charAt(Math.floor(Math.random()*a.length));return i},ls=()=>{var Ae,_e,Te;const{studentId:a}=da(),i=oa(),d=ca(),{user:r}=ma(),l=ha(),o=Y(),h=De(),[s,t]=N.useState({type:"closed"}),[u,j]=N.useState("grades"),[k,L]=N.useState(!1),I=N.useRef(null),[x,g]=N.useState(!1),v=N.useRef(null),[A,m]=N.useState("");N.useEffect(()=>{var n;(n=d.state)!=null&&n.openTab&&j(d.state.openTab)},[d.state]);const{data:c,isLoading:R,isError:oe,error:Ee}=ga({queryKey:["studentDetails",a],queryFn:async()=>{if(!a||!r)throw new Error("User or Student ID not found");const n=await f.from("students").select("*").eq("id",a).eq("user_id",r.id).single();if(n.error)throw new Error(n.error.message);const[b,y,q,K,te,pe,Me]=await Promise.all([f.from("reports").select("*").eq("student_id",a),f.from("attendance").select("*").eq("student_id",a),f.from("academic_records").select("*").eq("student_id",a),f.from("violations").select("*").eq("student_id",a),f.from("quiz_points").select("*").eq("student_id",a),f.from("classes").select("*").eq("user_id",r.id),f.from("communications").select("*").eq("student_id",a).order("created_at",{ascending:!0})]),Ie=[b,y,q,K,te,pe,Me].map(W=>W.error).filter(Boolean);if(Ie.length>0)throw new Error(Ie.map(W=>W.message).join(", "));const qe=n.data,ke=(pe.data||[]).find(W=>W.id===qe.class_id);return{student:{...qe,classes:ke?{id:ke.id,name:ke.name}:null},reports:b.data||[],attendanceRecords:y.data||[],academicRecords:q.data||[],violations:K.data||[],quizPoints:te.data||[],classes:pe.data||[],communications:Me.data||[]}},enabled:!!a&&!!r}),{studentMutation:G,reportMutation:ce,academicMutation:me,quizMutation:he,violationMutation:ge,communicationMutation:Ne,deleteMutation:ve,sendMessageMutation:we,applyPointsMutation:ue}=Wa(a,()=>t({type:"closed"})),Be=n=>{const b={name:n.name,gender:n.gender,class_id:n.class_id};G.mutate(b)},Fe=n=>{var y;if(!r||!a)return;const b={date:n.date,title:n.title,notes:n.notes,student_id:a,user_id:r.id};s.type==="report"&&((y=s.data)!=null&&y.id)?ce.mutate({operation:"edit",data:b,id:s.data.id}):ce.mutate({operation:"add",data:b})},Le=n=>{var y;if(!r||!a)return;const b={subject:n.subject,assessment_name:n.assessment_name,score:n.score,notes:n.notes||"",student_id:a,user_id:r.id};s.type==="academic"&&((y=s.data)!=null&&y.id)?me.mutate({operation:"edit",data:b,id:s.data.id}):me.mutate({operation:"add",data:b})},Ge=n=>{var y;if(!r||!a)return;const b={quiz_date:n.quiz_date,subject:n.subject,quiz_name:n.quiz_name,points:1,max_points:1,student_id:a,user_id:r.id};s.type==="quiz"&&((y=s.data)!=null&&y.id)?he.mutate({operation:"edit",data:b,id:s.data.id}):he.mutate({operation:"add",data:b})},Ue=n=>{var q;if(!r||!a)return;const b=$e.find(K=>K.description===n.description),y={date:n.date,description:n.description,points:(b==null?void 0:b.points)||0,student_id:a,user_id:r.id};s.type==="violation"&&((q=s.data)!=null&&q.id)?ge.mutate({operation:"edit",data:y,id:s.data.id}):ge.mutate({operation:"add",data:y})},He=n=>{var b;s.type==="editCommunication"&&((b=s.data)!=null&&b.id)&&Ne.mutate({operation:"edit",data:{message:n.message},id:s.data.id})},Q=(n,b)=>{t({type:"confirmDelete",title:"Konfirmasi Hapus",message:"Apakah Anda yakin ingin menghapus data ini secara permanen?",onConfirm:()=>ve.mutate({table:n,id:b}),isPending:ve.isPending})},ee=N.useMemo(()=>{const n={Hadir:0,Izin:0,Sakit:0,Alpha:0};return c==null||c.attendanceRecords.forEach(b=>{n[b.status]++}),n},[c==null?void 0:c.attendanceRecords]),Je=N.useMemo(()=>(c==null?void 0:c.violations.reduce((n,b)=>n+b.points,0))||0,[c==null?void 0:c.violations]),Se=N.useMemo(()=>(c==null?void 0:c.communications.filter(n=>n.sender==="parent"&&!n.is_read).length)||0,[c==null?void 0:c.communications]),Oe=async()=>{if(!a||G.isPending)return;const n=Ya();G.mutate({access_code:n})},Qe=async n=>{if(!n.target.files||n.target.files.length===0||!a)return;g(!0);const b=n.target.files[0];try{const y=await Na(b,{maxWidth:300,quality:.8}),q=`student_avatars/${a}-${new Date().getTime()}.jpg`,{error:K}=await f.storage.from("student_assets").upload(q,y,{upsert:!0});if(K)throw K;const{data:te}=f.storage.from("student_assets").getPublicUrl(q);G.mutate({avatar_url:te.publicUrl})}catch(y){o.error(`Gagal unggah foto: ${y.message}`)}finally{g(!1)}};N.useEffect(()=>{(async()=>{if(u==="communication"&&(c!=null&&c.communications)){const b=c.communications.filter(y=>y.sender==="parent"&&!y.is_read).map(y=>y.id);if(b.length>0){const{error:y}=await f.from("communications").update({is_read:!0}).in("id",b);y?console.error("Failed to mark messages as read:",y):h.invalidateQueries({queryKey:["studentDetails",a]})}}})()},[u,c==null?void 0:c.communications,a,h]),N.useEffect(()=>{var n;(n=v.current)==null||n.scrollIntoView({behavior:"smooth"})},[c==null?void 0:c.communications]);const ae=N.useMemo(()=>{if(!(c!=null&&c.academicRecords))return[];const b=c.academicRecords.map(y=>y.subject);return[...new Set(b)]},[c==null?void 0:c.academicRecords]),xe=N.useMemo(()=>!A||!(c!=null&&c.academicRecords)?null:c.academicRecords.filter(n=>n.subject===A).sort((n,b)=>new Date(b.created_at).getTime()-new Date(n.created_at).getTime())[0],[A,c==null?void 0:c.academicRecords]);N.useEffect(()=>{if(s.type==="applyPoints"){const n=ae.length>0?ae[0]:"";m(n||"")}else m("")},[s.type,ae]);const We=()=>{if(!A){o.error("Silakan pilih mata pelajaran.");return}ue.mutate(A)};if(R)return e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})});if(oe)return e.jsxs("div",{className:"flex items-center justify-center h-screen",children:["Error: ",Ee.message]});if(!c||!c.student)return null;const{student:S,reports:Ye,academicRecords:Pe,quizPoints:se,violations:Ce,classes:Xe,communications:Ze}=c;return e.jsxs("div",{className:"space-y-8 p-4 md:p-6 pb-32 lg:pb-6 animate-fade-in-up bg-gray-50 dark:bg-gray-950 min-h-full max-w-7xl mx-auto",children:[e.jsxs("div",{className:"no-print",children:[e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"outline",size:"icon",onClick:()=>i(-1),"aria-label":"Kembali",className:"bg-white/50 dark:bg-white/10 border-gray-200 dark:border-white/20 hover:bg-white/80 dark:hover:bg-white/20 text-gray-900 dark:text-white",children:e.jsx(ua,{className:"w-5 h-5"})}),e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:S.avatar_url||`https://i.pravatar.cc/150?u=${S.id}`,alt:S.name,className:"w-20 h-20 rounded-full object-cover border-4 border-white shadow-lg dark:border-white/10"}),e.jsx("input",{type:"file",ref:I,onChange:Qe,accept:"image/png, image/jpeg",className:"hidden",disabled:x||!l}),e.jsx("button",{onClick:()=>{var n;return(n=I.current)==null?void 0:n.click()},disabled:x||!l,className:"absolute -bottom-1 -right-1 p-1.5 bg-purple-600 text-white rounded-full shadow-md hover:scale-110 transition-transform",children:e.jsx(xa,{className:"w-4 h-4"})})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 dark:text-white",children:S.name}),e.jsxs("p",{className:"text-md text-gray-500 dark:text-gray-400",children:["Kelas ",((Ae=S.classes)==null?void 0:Ae.name)||"N/A"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 self-start md:self-center",children:[e.jsxs(p,{variant:"outline",onClick:()=>t({type:"editStudent",data:S}),disabled:!l,className:"bg-white/50 dark:bg-white/10 border-gray-200 dark:border-white/20 hover:bg-white/80 dark:hover:bg-white/20 text-gray-900 dark:text-white",children:[e.jsx(pa,{className:"w-4 h-4 mr-2"}),"Edit Profil"]}),e.jsx(ka,{to:`/cetak-rapot/${a}`,children:e.jsxs(p,{children:[e.jsx(ba,{className:"w-4 h-4 mr-2"}),"Cetak Rapor"]})})]})]}),e.jsx(Aa,{studentDetails:c}),e.jsxs("section",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(ne,{icon:F,label:"Total Kehadiran",value:`${ee.Hadir} hari`,color:"from-green-500 to-emerald-400"}),e.jsx(ne,{icon:le,label:"Total Izin/Sakit",value:`${ee.Izin+ee.Sakit} hari`,color:"from-yellow-500 to-amber-400"}),e.jsx(ne,{icon:ja,label:"Total Alpha",value:`${ee.Alpha} hari`,color:"from-orange-500 to-red-400"}),e.jsx(ne,{icon:Ke,label:"Poin Pelanggaran",value:Je,color:"from-red-500 to-rose-400"})]}),e.jsx(M,{children:e.jsxs(ya,{value:u,onValueChange:j,className:"w-full",children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-white/10",children:e.jsx("div",{className:"flex justify-start sm:justify-center px-4 sm:px-6 overflow-x-auto scrollbar-hide",children:e.jsxs(fa,{className:"bg-gray-100 dark:bg-black/20",children:[e.jsx(D,{value:"grades",children:"Nilai"}),e.jsx(D,{value:"activity",children:"Keaktifan"}),e.jsx(D,{value:"violations",children:"Pelanggaran"}),e.jsx(D,{value:"reports",children:"Catatan Guru"}),e.jsxs(D,{value:"development",children:[e.jsx(de,{className:"w-4 h-4 mr-1.5 inline"}),"Analisis Perkembangan"]}),e.jsx(D,{value:"communication",children:e.jsxs("div",{className:"relative",children:["Komunikasi",Se>0&&e.jsx("span",{className:"absolute -top-1 -right-3 w-4 h-4 bg-red-500 rounded-full text-xs text-white flex items-center justify-center",children:Se})]})}),e.jsx(D,{value:"portal",children:"Portal Ortu"})]})})}),e.jsx($,{value:"grades",className:"p-0",children:e.jsx(Ta,{records:Pe,onAdd:()=>t({type:"academic",data:null}),onEdit:n=>t({type:"academic",data:n}),onDelete:n=>Q("academic_records",n),isOnline:l})}),e.jsx($,{value:"activity",className:"p-0",children:e.jsx(Ia,{quizPoints:se,onAdd:()=>t({type:"quiz",data:null}),onEdit:n=>t({type:"quiz",data:n}),onDelete:n=>Q("quiz_points",n),onApplyPoints:()=>t({type:"applyPoints"}),isOnline:l})}),e.jsx($,{value:"violations",className:"p-0",children:e.jsx(qa,{violations:Ce,onAdd:()=>t({type:"violation",mode:"add",data:null}),onEdit:n=>t({type:"violation",mode:"edit",data:n}),onDelete:n=>Q("violations",n),isOnline:l})}),e.jsx($,{value:"reports",className:"p-0",children:e.jsx(za,{reports:Ye,onAdd:()=>t({type:"report",data:null}),onEdit:n=>t({type:"report",data:n}),onDelete:n=>Q("reports",n),isOnline:l})}),e.jsx($,{value:"development",className:"p-6",children:e.jsx(Ca,{studentData:{student:{name:S.name,age:S.age||12,class:(_e=S.classes)==null?void 0:_e.name},academicRecords:Pe.map(n=>({subject:n.subject,score:n.score,assessment_name:n.assessment_name,notes:n.notes})),attendanceRecords:c.attendanceRecords.map(n=>({status:n.status,date:n.date})),violations:Ce.map(n=>({description:n.description,points:n.points,date:n.date})),quizPoints:se.map(n=>({activity:n.quiz_name,points:n.points,date:n.quiz_date}))}})}),e.jsx($,{value:"communication",className:"p-0",children:e.jsx(Ra,{communications:Ze,userAvatarUrl:r==null?void 0:r.avatarUrl,onSendMessage:n=>we.mutate(n),onEditMessage:n=>t({type:"editCommunication",data:n}),onDeleteMessage:n=>Q("communications",n),isOnline:l,isSending:we.isPending})}),e.jsx($,{value:"portal",className:"p-0",children:e.jsx(Ka,{student:S,onGenerateCode:Oe,isOnline:l,isGenerating:G.isPending})})]})})]}),e.jsx("div",{className:"hidden print:block",children:e.jsx("div",{id:"printable-slip",children:e.jsxs("div",{className:"p-8 text-black",style:{width:"12cm",fontFamily:"sans-serif"},children:[e.jsx("h3",{className:"text-lg font-bold",children:"Informasi Akses Portal Siswa"}),e.jsx("p",{className:"text-sm mb-4",children:"Harap simpan informasi ini dengan baik."}),e.jsxs("div",{className:"border-t border-b border-gray-300 py-4 my-4",children:[e.jsx("p",{className:"text-xs",children:"Nama Siswa:"}),e.jsx("p",{className:"text-base font-semibold",children:S.name}),e.jsx("p",{className:"text-xs mt-2",children:"Kelas:"}),e.jsx("p",{className:"text-base font-semibold",children:((Te=S.classes)==null?void 0:Te.name)||"N/A"})]}),e.jsx("p",{className:"text-center text-sm",children:"Gunakan kode berikut untuk masuk:"}),e.jsx("div",{className:"text-center my-2 p-3 bg-gray-100 rounded-md",children:e.jsx("p",{className:"text-3xl font-mono font-bold tracking-widest",children:S.access_code})}),e.jsxs("p",{className:"text-center text-xs mt-4",children:["Masuk melalui: ",e.jsx("span",{className:"font-mono",children:window.location.origin})]})]})})}),["grades","activity","violations","reports"].includes(u)&&e.jsx(va,{icon:e.jsx(X,{className:"w-6 h-6"}),onClick:()=>{u==="grades"&&t({type:"academic",data:null}),u==="activity"&&t({type:"quiz",data:null}),u==="violations"&&t({type:"violation",mode:"add",data:null}),u==="reports"&&t({type:"report",data:null})},className:"fixed bottom-24 right-4 lg:bottom-8 lg:right-8 z-40 shadow-xl shadow-blue-500/20","aria-label":"Tambah Data"}),s.type==="applyPoints"?e.jsx(be,{isOpen:!0,onClose:()=>t({type:"closed"}),title:"Gunakan Poin Keaktifan",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Anda akan menggunakan ",e.jsxs("strong",{children:[se.length," poin"]})," keaktifan sebagai nilai tambahan. Poin ini akan dihapus setelah digunakan."]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"subject-select",className:"block text-sm font-medium mb-1",children:"Pilih Mata Pelajaran"}),e.jsxs(fe,{id:"subject-select",value:A,onChange:n=>m(n.target.value),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"-- Pilih --"}),ae.map(n=>n&&e.jsx("option",{value:n,children:n},n))]})]}),xe&&e.jsxs("div",{className:"p-3 bg-gray-100 dark:bg-gray-800 rounded-md text-sm",children:[e.jsxs("p",{children:["Nilai Saat Ini: ",e.jsx("strong",{className:"text-lg",children:xe.score})]}),e.jsxs("p",{children:["Nilai Baru: ",e.jsx("strong",{className:"text-lg text-green-500",children:Math.min(100,xe.score+se.length)})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(p,{type:"button",variant:"ghost",onClick:()=>t({type:"closed"}),children:"Batal"}),e.jsx(p,{type:"button",onClick:We,disabled:ue.isPending||!A,children:ue.isPending?"Menerapkan...":"Terapkan Poin"})]})]})}):s.type!=="closed"&&s.type!=="confirmDelete"&&e.jsxs(be,{isOpen:!0,onClose:()=>t({type:"closed"}),title:s.type==="editStudent"?"Edit Profil Siswa":s.type==="report"?s.data?"Edit Catatan":"Tambah Catatan Baru":s.type==="academic"?s.data?"Edit Nilai":"Tambah Nilai Baru":s.type==="quiz"?s.data?"Edit Poin":"Tambah Poin Keaktifan":s.type==="editCommunication"?"Edit Pesan":"Tambah Pelanggaran",children:[s.type==="editStudent"&&e.jsx(Ga,{defaultValues:s.data,classes:Xe,onSubmit:Be,onClose:()=>t({type:"closed"}),isPending:G.isPending}),s.type==="report"&&e.jsx(Ua,{defaultValues:s.data,onSubmit:Fe,onClose:()=>t({type:"closed"}),isPending:ce.isPending}),s.type==="academic"&&e.jsx(Ha,{defaultValues:s.data,onSubmit:Le,onClose:()=>t({type:"closed"}),isPending:me.isPending}),s.type==="quiz"&&e.jsx(Ja,{defaultValues:s.data,onSubmit:Ge,onClose:()=>t({type:"closed"}),isPending:he.isPending}),s.type==="violation"&&e.jsx(Oa,{defaultValues:s.data,onSubmit:Ue,onClose:()=>t({type:"closed"}),isPending:ge.isPending}),s.type==="editCommunication"&&e.jsx(Qa,{defaultValues:s.data,onSubmit:He,onClose:()=>t({type:"closed"}),isPending:Ne.isPending})]}),s.type==="confirmDelete"&&e.jsxs(be,{isOpen:!0,onClose:()=>t({type:"closed"}),title:s.title,children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.message}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(p,{type:"button",variant:"ghost",onClick:()=>t({type:"closed"}),disabled:s.isPending,children:"Batal"}),e.jsx(p,{type:"button",variant:"destructive",onClick:s.onConfirm,disabled:s.isPending,children:s.isPending?"Menghapus...":"Ya, Hapus"})]})]})]})};export{ls as default};

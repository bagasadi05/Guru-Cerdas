import{u as z,y as Q,b as $,z as L,a8 as J,a as Y,r as w,g as R,j as e,Z,i as A,p as H,n as E,P as G,f as M,I as F,B as v,V as U,K as W,Y as X,s as T}from"./index-D1C6o8KR.js";import{u as P}from"./useMutation-DEQ-bH50.js";import{C as ee}from"./Checkbox-DScJh7tZ.js";import{F as te}from"./FloatingActionButton-CQmhLiOc.js";import{D as ae,a as se,b as re,c as q}from"./DropdownMenu-r_PFnRXN.js";const C=({task:s,onEdit:f,onDelete:x,onStatusChange:u,isOnline:h})=>{const c=s.status==="done",r=(()=>{if(c)return{border:"border-green-500",bg:"bg-green-500/10",text:"text-green-600 dark:text-green-400"};if(!s.due_date)return{border:"border-gray-300 dark:border-gray-600",bg:"bg-white dark:bg-gray-800",text:"text-gray-600 dark:text-gray-400"};const n=new Date;n.setHours(0,0,0,0);const m=new Date(s.due_date);return m.setHours(0,0,0,0),m<n?{border:"border-red-500",bg:"bg-red-50 dark:bg-red-900/10",text:"text-red-600 dark:text-red-400"}:m.getTime()===n.getTime()?{border:"border-sky-500",bg:"bg-sky-50 dark:bg-sky-900/10",text:"text-sky-600 dark:text-sky-400"}:{border:"border-l-4 border-l-gray-300 dark:border-l-gray-600",bg:"bg-white dark:bg-gray-800",text:"text-gray-600 dark:text-gray-400"}})();return e.jsx("div",{className:`
            relative group
            bg-white dark:bg-gray-800 
            rounded-xl p-5 
            border-l-4 ${r.border}
            shadow-sm hover:shadow-md transition-all duration-200
            ${c?"opacity-60":""}
        `,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(ee,{checked:c,onChange:()=>u(s.id,c?"todo":"done"),disabled:!h,className:"mt-1 w-7 h-7 rounded-full border-2"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h3",{className:`font-semibold text-lg mb-1 break-words ${c?"line-through text-gray-500":"text-gray-900 dark:text-white"}`,children:s.title}),e.jsxs(ae,{children:[e.jsx(se,{className:"w-10 h-10 flex items-center justify-center rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-400 dark:text-gray-500 transition-colors -mr-2 -mt-2",children:e.jsx(U,{className:"w-5 h-5"})}),e.jsxs(re,{children:[e.jsx(q,{icon:e.jsx(W,{className:"w-4 h-4"}),onClick:()=>f(s),children:"Edit"}),e.jsx(q,{icon:e.jsx(X,{className:"w-4 h-4 text-red-500"}),onClick:()=>x(s.id),className:"text-red-600 dark:text-red-400",children:"Hapus"})]})]})]}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 line-clamp-2 mb-3",children:s.description}),e.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[s.due_date&&e.jsxs("span",{className:`flex items-center gap-1.5 font-medium ${r.text}`,children:[e.jsx(A,{className:"w-4 h-4"}),new Date(s.due_date).toLocaleDateString("id-ID",{day:"numeric",month:"short"})]}),!s.due_date&&e.jsxs("span",{className:"flex items-center gap-1.5 text-gray-400",children:[e.jsx(H,{className:"w-4 h-4"}),"Tanpa tenggat"]})]})]})]})})},ce=()=>{var D,_,S,O;const{user:s}=z(),f=Q(),x=$(),u=L(),h=J(),c=Y(),[l,r]=w.useState({isOpen:!1,mode:"add",data:null}),[n,m]=w.useState(null),{data:b=[],isLoading:B}=R({queryKey:["tasks",s==null?void 0:s.id],queryFn:async()=>{const{data:t,error:a}=await T.from("tasks").select("*").eq("user_id",s.id).order("created_at",{ascending:!1});if(a)throw a;return t||[]},enabled:!!s});w.useEffect(()=>{var a;const t=(a=h.state)==null?void 0:a.prefill;if(t){const o={id:"",user_id:(s==null?void 0:s.id)||"",created_at:new Date().toISOString(),title:t.title||"",description:t.description||"",due_date:t.due_date||null,status:t.status||"todo"};r({isOpen:!0,mode:"add",data:o}),c(h.pathname,{replace:!0,state:{}})}},[(D=h.state)==null?void 0:D.prefill,s,c]);const p=P({mutationFn:async t=>{if(t.mode==="add"){const{error:a}=await T.from("tasks").insert(t.data);if(a)throw a}else{const{error:a}=await T.from("tasks").update(t.data).eq("id",t.id);if(a)throw a}},onSuccess:(t,a)=>{f.invalidateQueries({queryKey:["tasks",s==null?void 0:s.id]}),a.mode!=="status_change"&&(x.success("Tugas berhasil disimpan!"),r({isOpen:!1,mode:"add",data:null}))},onError:t=>x.error(t.message)}),y=P({mutationFn:async t=>{const{error:a}=await T.from("tasks").delete().eq("id",t);if(a)throw a},onSuccess:()=>{f.invalidateQueries({queryKey:["tasks",s==null?void 0:s.id]}),x.success("Tugas berhasil dihapus.")},onError:t=>x.error(t.message)}),d=w.useMemo(()=>{const t=new Date;t.setHours(0,0,0,0);const a=[],o=[],k=[],I=[];return b.forEach(i=>{if(i.status==="done"){I.push(i);return}if(!i.due_date){k.push(i);return}const g=new Date(i.due_date);g.setHours(0,0,0,0),g<t?a.push(i):g.getTime()===t.getTime()?o.push(i):k.push(i)}),k.sort((i,g)=>i.due_date?g.due_date?new Date(i.due_date).getTime()-new Date(g.due_date).getTime():-1:1),{overdue:a,today:o,upcoming:k,completed:I}},[b]),K=t=>{t.preventDefault();const a=new FormData(t.currentTarget),o={title:a.get("title"),description:a.get("description"),due_date:a.get("due_date")?a.get("due_date"):null};l.mode==="add"?p.mutate({mode:"add",data:{...o,user_id:s.id,status:"todo"}}):l.data&&p.mutate({mode:"edit",data:o,id:l.data.id})},j=(t,a)=>{p.mutate({mode:"status_change",data:{status:a},id:t})},N=t=>{const a=b.find(o=>o.id===t);a&&m(a)},V=()=>{n&&(y.mutate(n.id),m(null))};return B?e.jsx("div",{className:"flex items-center justify-center h-full bg-gray-50 dark:bg-gray-950",children:e.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{className:"w-full min-h-full pb-24 bg-gray-50 dark:bg-gray-950",children:[e.jsx("div",{className:"holographic-orb-container",style:{top:"-40px",width:"120px",height:"120px",opacity:.7},children:e.jsxs("div",{className:"holographic-orb",children:[e.jsx("div",{className:"orb-glow"}),e.jsx("div",{className:"orb-core"}),e.jsx("div",{className:"orb-ring orb-ring-1"}),e.jsx("div",{className:"orb-ring orb-ring-2"})]})}),e.jsxs("div",{className:"p-4 sm:p-6 max-w-3xl mx-auto relative z-10",children:[e.jsxs("header",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-gray-900 dark:text-white",children:"Tugas Saya"}),e.jsx("p",{className:"mt-1 text-gray-600 dark:text-indigo-200",children:"Kelola tenggat waktu dan prioritas Anda."})]}),e.jsxs("div",{className:"space-y-8",children:[d.overdue.length>0&&e.jsxs("section",{className:"animate-fade-in-up",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 px-1",children:[e.jsx(Z,{className:"w-5 h-5 text-red-500"}),e.jsxs("h2",{className:"font-bold text-lg text-red-600 dark:text-red-400",children:["Terlambat (",d.overdue.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:d.overdue.map(t=>e.jsx(C,{task:t,onEdit:a=>r({isOpen:!0,mode:"edit",data:a}),onDelete:N,onStatusChange:j,isOnline:u},t.id))})]}),d.today.length>0&&e.jsxs("section",{className:"animate-fade-in-up animation-delay-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 px-1",children:[e.jsx(A,{className:"w-5 h-5 text-sky-500"}),e.jsxs("h2",{className:"font-bold text-lg text-gray-900 dark:text-white",children:["Hari Ini (",d.today.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:d.today.map(t=>e.jsx(C,{task:t,onEdit:a=>r({isOpen:!0,mode:"edit",data:a}),onDelete:N,onStatusChange:j,isOnline:u},t.id))})]}),d.upcoming.length>0&&e.jsxs("section",{className:"animate-fade-in-up animation-delay-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 px-1",children:[e.jsx(H,{className:"w-5 h-5 text-gray-500 dark:text-gray-400"}),e.jsxs("h2",{className:"font-bold text-lg text-gray-900 dark:text-white",children:["Mendatang (",d.upcoming.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:d.upcoming.map(t=>e.jsx(C,{task:t,onEdit:a=>r({isOpen:!0,mode:"edit",data:a}),onDelete:N,onStatusChange:j,isOnline:u},t.id))})]}),d.completed.length>0&&e.jsxs("section",{className:"animate-fade-in-up animation-delay-300",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 px-1",children:[e.jsx(E,{className:"w-5 h-5 text-green-500"}),e.jsxs("h2",{className:"font-bold text-lg text-gray-900 dark:text-white",children:["Selesai (",d.completed.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:d.completed.map(t=>e.jsx(C,{task:t,onEdit:a=>r({isOpen:!0,mode:"edit",data:a}),onDelete:N,onStatusChange:j,isOnline:u},t.id))})]}),b.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mb-4",children:e.jsx(E,{className:"w-10 h-10 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Semua beres!"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 max-w-xs mx-auto mt-1",children:"Anda tidak memiliki tugas yang tertunda. Nikmati waktu luang Anda atau tambahkan tugas baru."})]})]})]}),e.jsx(te,{position:"bottom-right",offset:{bottom:88,right:16},size:64,onClick:()=>r({isOpen:!0,mode:"add",data:null}),className:"z-40 shadow-xl shadow-blue-500/20",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-6 h-6"}),e.jsx("span",{className:"max-w-0 overflow-hidden group-hover:max-w-xs transition-all duration-300 text-base font-medium whitespace-nowrap",children:"Tambah Tugas"})]})}),e.jsx(M,{title:l.mode==="add"?"Tambah Tugas Baru":"Edit Tugas",isOpen:l.isOpen,onClose:()=>r(t=>({...t,isOpen:!1})),children:e.jsxs("form",{onSubmit:K,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Judul"}),e.jsx(F,{id:"title",name:"title",defaultValue:((_=l.data)==null?void 0:_.title)||"",required:!0,className:"mt-1",placeholder:"Contoh: Periksa ujian kelas 7A"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Deskripsi (Opsional)"}),e.jsx("textarea",{id:"description",name:"description",defaultValue:((S=l.data)==null?void 0:S.description)||"",rows:3,className:"mt-1 block w-full rounded-xl border-gray-300 shadow-sm focus:border-sky-500 focus:ring-sky-500 sm:text-sm dark:bg-gray-800 dark:border-gray-600 dark:text-white p-3",placeholder:"Tambahkan detail tugas..."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"due_date",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Tanggal Jatuh Tempo (Opsional)"}),e.jsx(F,{id:"due_date",name:"due_date",type:"date",defaultValue:((O=l.data)==null?void 0:O.due_date)||"",className:"mt-1"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(v,{type:"button",variant:"ghost",onClick:()=>r(t=>({...t,isOpen:!1})),children:"Batal"}),e.jsx(v,{type:"submit",disabled:p.isPending||!u,children:p.isPending?"Menyimpan...":"Simpan"})]})]})}),e.jsx(M,{title:"Konfirmasi Hapus Tugas",isOpen:!!n,onClose:()=>m(null),children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Apakah Anda yakin ingin menghapus tugas ini?",e.jsxs("strong",{className:"block mt-2 p-3 bg-gray-100 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 text-gray-900 dark:text-white",children:['"',n==null?void 0:n.title,'"']})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 mt-4",children:[e.jsx(v,{variant:"ghost",onClick:()=>m(null),disabled:y.isPending,children:"Batal"}),e.jsx(v,{variant:"destructive",onClick:V,disabled:y.isPending,children:y.isPending?"Menghapus...":"Ya, Hapus"})]})]})})]})};export{ce as default};
